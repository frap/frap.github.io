
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>PIM Study Notes - Andrés Gasson.</title>
  <meta name="author" content="Andrés Gasson">

  
  <meta name="description" content="PIM CCIE Study Notes for CCIE study">
  <meta name="keywords" content="CCIE, PIM, Multicast, Cisco, CCIE Study notes">

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.red-elvis.net/2009/01/07/pim">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="http://feeds.feedburner.com/RamblingsOfAGeekyElvis" rel="alternate" title="Andrés Gasson." type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='http://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic' rel='stylesheet' type='text/css'>


  

</head>

<body   >
  <header role="banner"><hgroup>
</hgroup>

</header>
  <!-- <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="http://feeds.feedburner.com/RamblingsOfAGeekyElvis" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://www.duckduckgo.com/" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:www.red-elvis.net" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav> -->
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">PIM Study Notes</h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-01-07T23:02:00+13:00" pubdate data-updated="true">Jan 7<span>th</span>, 2009</time>
        
      </p>
    
  </header>


<div class="entry-content"><h2>PIM Neigbour Discovery</h2>

<p>PIM routers send PIM Hello messages every 30 seconds on each PIM enabled interface.  The Hellos are sent to 224.0.0.13, the link local address reserved for All-PIM-Routers</p>

<h2>PIM DR</h2>

<p>Hellos are used to find neighbors, and to determine who should be the Designated Router (DR) on multi-access networks.  If no DR priority configured, then the PIM router with the highest IP address wins.  In PIM Sparse Mode, the DR is responsible for registering to the RP, and forwarding traffic.</p>

<h2>PIM Asserts</h2>

<p>If a router sees traffic for a stream coming in on an interface it uses to forward traffic for the stream, it will send an Assert message on that interface.   The assert contains administrative distance and metric information for the route in the murib for the source of the stream.  First administrative distance is compared.  If equal, metric is compared.  If the metric is also equal, than the peer with the highest IP address wins. The loser prunes itself off the path for the stream.</p>

<!-- more -->


<h2>PIM SM</h2>

<p>A PIM router creates (S,G) state under the following conditions</p>

<ul>
<li>Traffic is seen on a directly connected interface.
Examples: DR, routers in path down RPT from RP to LH</li>
<li>An RP receives a Register message.</li>
<li>A Join for the (S,G) is received.</li>
</ul>


<p>A PIM router forwards (S,G) Joins towards the source when</p>

<ul>
<li>The (S,G) has a valid outgoing interface list (olist) and the           router has RPF information for the source.</li>
</ul>


<h2>PIM SSM</h2>

<p>If IGMP knows the sources it wants to receive, it can inform it&rsquo;s router.  PIM can then forward joins directly to the source.  PIM-SSM takes this a step further by outlawing (*,G) state in the SSM range.  Not only isn&rsquo;t an RP required, it&rsquo;s prohibited.</p>

<p>232.0.0.0/8 is the default range for SSM, but it can be configured to any other range as well. Currently though 232/8 is hardwired in our (XR, IOS?) IGMP implementation, so no (*,G) IGMP reports will be accepted in that range.</p>

<p>These rules are directly from the PIM spec.</p>

<ul>
<li>A router MUST NOT send a (*,G) Join/Prune message for any reason.</li>
<li>A router MUST NOT send an (S,G,rpt) Join/Prune message for any reason.</li>
<li>A router MUST NOT send a Register message for any packet that is
destined to an SSM address.</li>
<li>A router MUST NOT forward packets based on (*,G) or (S,G,rpt) state.
The (*,G) and (S,G,rpt) -related state summarization macros are NULL for any SSM address, for the purposes of packet forwarding.</li>
<li>A router acting as an RP MUST NOT forward any Register-encapsulated packet that has an SSM destination address</li>
</ul>


<h2>PIM-BIDIR</h2>

<p>PIM-BIDIR makes the RPT bidirectional.   The RP is the hub of all traffic, though traffic does not have to go all the way to the RP to reach local leaf nodes.  BIDIR forwards on (*,G) routes.</p>

<p>Simpler than PIM-SM.  No data driven events (eg, S,G creation based on data, KAT).</p>

<p>New sources are forwarded on the path to the RP (called the (*,G/M) route.</p>

<p>New (*,G) joins propagate towards the RP, and inherit accepting information from the RP.  The joins will create outgoing interface information – pointing back towards the LH (Last Hop).</p>

<h2>MSDP</h2>

<p>MSDP listens to PIM register messages, and if PIM installs an L flag for the route in the MRIB, MSDP sends the traffic in the registers encapsulated in Source Active (SA) messages to it&rsquo;s configured peers.</p>

<p>If the remote RP has local receivers for the (S,G), it installs the route into the PIM topology table and forwards the traffic down the RPT.  The LH router performs SPT switchover.</p>

<p>If the remote RP has no local PIM interest in the SA, the SA stays in the MSDP cache but is not installed in PIM.</p>

<p>An SA contains the (S,G) info, the RP that originated the SA, and the encapsulated data sent in the register.</p>

<p>MSDP can be thought of as a poor man&rsquo;s BGP. It doesn&rsquo;t have ASs (so NO good loop avoidance), and it doesn&rsquo;t have policy other than filtering.  It uses the below set of rules to determine which peers to accept SAs from, based on the RP which originated the SA.
connect-source == peer address used
originator-id == RP address SA sent from.</p>

<p> 1) The MSDP peer P&rsquo;s connect-source is equal to the originator-id of the SA</p>

<p> 2) The MSDP peer P&rsquo;s connect-source is equal to the BGP NEXT-HOP of the active route for the originator-id of the SA</p>

<p> 3) a) The active route for the originator-id of the SA is known via BGP and the MSDP peer P&rsquo;s connect-source is equal to the BGP peering address of the peer who announced the route.</p>

<p>   b) The active route for the originator-id of the SA is known via ISIS/OSPF and the MSDP peer P&rsquo;s connect-source is equal to the IGP next hop for the route.</p>

<p> 4) The MSDP peer P&rsquo;s connect-source is in an AS in the AS-PATH of the active route for the originator-id of the SA, and has the highest IP address of the MSDP peer&rsquo;s connect-sources which reside in ASs in that AS-PATH.</p>

<p>5) The MSDP peer P is configured as the static RPF-peer.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Andrés Gasson</span></span>

      








  


<time datetime="2009-01-07T23:02:00+13:00" pubdate data-updated="true">Jan 7<span>th</span>, 2009</time>
      

<span class="categories">
  
    <a class='category' href='/categories/ccie/'>CCIE</a>, <a class='category' href='/categories/msdp/'>MSDP</a>, <a class='category' href='/categories/multicast/'>Multicast</a>, <a class='category' href='/categories/networking/'>Networking</a>, <a class='category' href='/categories/pim/'>PIM</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://www.red-elvis.net/2009/01/07/pim/" data-via="agasson" data-counturl="http://www.red-elvis.net/2009/01/07/pim/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/2008/12/17/acls/" title="Previous Post: CCIE ACL Study Notes">&laquo; CCIE ACL Study Notes</a>
      
      
        <a class="basic-alignment right" href="/2009/01/25/ipv6/" title="Next Post: IPv6 Study Notes">IPv6 Study Notes &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <ul id="recent_posts">
      <li class="post">
      <a href="http://www.red-elvis.net" alt="Home"><img src="/images/Home.png"></a>
      <a href="http://www.red-elvis.net/archives/" alt="Archives"><img src="/images/Calendar.png"></a>
      <a href="mailto:" alt="E-Mail"><img src="/images/Envelope.png"></a>
      <a href="http://www.red-elvis.net/atom.xml" alt="subscribe feed"><img src="/images/rss_big.png"></a>
      </li>
  </ul>
</section>

<section>
	<span>
		<img src="http://www.gravatar.com/avatar/4cbc061c24e36092e7f778816082e345" alt="Gravatar of Andrés Gasson " title="Gravatar of Andrés Gasson" />
	</span>
</section>
<section>
  <h1>Tag Cloud</h1>
    <span id="tag-cloud"><a href='/categories/acls' style='font-size: 110.0%'>ACLs(1)</a> <a href='/categories/atm' style='font-size: 110.0%'>ATM(1)</a> <a href='/categories/bgp' style='font-size: 110.0%'>BGP(1)</a> <a href='/categories/ccie' style='font-size: 160.0%'>CCIE(6)</a> <a href='/categories/ipv6' style='font-size: 110.0%'>IPv6(1)</a> <a href='/categories/l2' style='font-size: 110.0%'>L2(1)</a> <a href='/categories/msdp' style='font-size: 110.0%'>MSDP(1)</a> <a href='/categories/multicast' style='font-size: 110.0%'>Multicast(1)</a> <a href='/categories/networking' style='font-size: 140.0%'>Networking(4)</a> <a href='/categories/pim' style='font-size: 110.0%'>PIM(1)</a> <a href='/categories/pos' style='font-size: 110.0%'>POS(1)</a> <a href='/categories/security' style='font-size: 110.0%'>Security(1)</a> <a href='/categories/time' style='font-size: 110.0%'>Time(1)</a> </span>
</section>

<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/agasson@red-elvis.net?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating...</li>
  </ul>
  <script type="text/javascript">
    $(document).ready(function(){
      getTwitterFeed("agasson", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/agasson" class="twitter-follow-button" data-show-count="false">Follow @agasson</a>
  
</section>

<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2009/01/25/ipv6/">IPv6 Study Notes</a>
      </li>
    
      <li class="post">
        <a href="/2009/01/07/pim/">PIM Study Notes</a>
      </li>
    
      <li class="post">
        <a href="/2008/12/17/acls/">CCIE ACL Study Notes</a>
      </li>
    
      <li class="post">
        <a href="/2008/12/17/bgp/">CCIE BGP Study Notes</a>
      </li>
    
      <li class="post">
        <a href="/2008/12/17/ntp/">NTP</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/frap">@frap</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'frap',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Andrés Gasson -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
