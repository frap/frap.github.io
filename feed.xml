<?xml version='1.0' encoding='UTF-8'?>
<rss version='2.0' xmlns:atom='http://www.w3.org/2005/Atom'>
<channel>
<atom:link href='http://geek.red-elvis.net/' rel='self' type='application/rss+xml'/>
<generator>
clj-rss
</generator>
<title>
Remove Accidental Complexity
</title>
<link>
http://geek.red-elvis.net/
</link>
<description>
Rants of an Old Networking Geek
</description>
<lastBuildDate>
Fri, 30 Jan 2015 00:16:44 +1300
</lastBuildDate>
<author>
Andrés Gasson
</author>
<item>
<guid>
http://geek.red-elvis.net/posts/2015-01-26-first-post.html
</guid>
<link>
http://geek.red-elvis.net/posts/2015-01-26-first-post.html
</link>
<title>
re-start blog
</title>
<description>
&lt;h3&gt;&lt;a name=&quot;trying&amp;#95;out&amp;#95;cryogen&quot;&gt;&lt;/a&gt;Trying out cryogen&lt;/h3&gt;&lt;p&gt;After a lapse of a few years, I am now trying to get my notes updated with my new flavour of programming language - clojure. So trying out the static blogger &lt;a href='http://cryogenweb.org/docs/writing-posts.html'&gt;cyrogen&lt;/a&gt; which I hope can help me get my notes up to date.&lt;/p&gt;&lt;p&gt;Lets us see how easy and automated it is. Alos will need to sort out my git skills.&lt;/p&gt;&lt;p&gt;Gas.&lt;/p&gt;
</description>
<pubDate>
Mon, 26 Jan 2015 00:00:00 +1300
</pubDate>
<author>
Andrés Gasson
</author>
</item>
<item>
<guid>
http://geek.red-elvis.net/posts/2009-06-26-pim.html
</guid>
<link>
http://geek.red-elvis.net/posts/2009-06-26-pim.html
</link>
<title>
PIM Notes
</title>
<description>
&lt;h2&gt;&lt;a name=&quot;pim&amp;#95;neigbour&amp;#95;discovery&quot;&gt;&lt;/a&gt;PIM Neigbour Discovery&lt;/h2&gt;PIM routers send PIM Hello messages every 30 seconds on each PIM enabled interface.  The Hellos are sent to 224.0.0.13, the link local address reserved for All-PIM-Routers&lt;h2&gt;&lt;a name=&quot;pim&amp;#95;dr&quot;&gt;&lt;/a&gt;PIM DR&lt;/h2&gt;Hellos are used to find neighbors, and to determine who should be the Designated Router (DR) on multi-access networks.  If no DR priority configured, then the PIM router with the highest IP address wins.  In PIM Sparse Mode, the DR is responsible for registering to the RP, and forwarding traffic.&lt;h2&gt;&lt;a name=&quot;pim&amp;#95;asserts&quot;&gt;&lt;/a&gt;PIM Asserts&lt;/h2&gt;If a router sees traffic for a stream coming in on an interface it uses to forward traffic for the stream, it will send an Assert message on that interface.   The assert contains administrative distance and metric information for the route in the murib for the source of the stream.  First administrative distance is compared.  If equal, metric is compared.  If the metric is also equal, than the peer with the highest IP address wins. The loser prunes itself off the path for the stream.&lt;h2&gt;&lt;a name=&quot;pim&amp;#95;sm&quot;&gt;&lt;/a&gt;PIM SM&lt;/h2&gt;A PIM router creates (S,G) state under the following conditions&lt;ul&gt;&lt;li&gt;Traffic is seen on a directly connected interface.   Examples: DR, routers in path down RPT from RP to LH&lt;/li&gt;&lt;li&gt;An RP receives a Register message.&lt;/li&gt;&lt;li&gt;A Join for the (S,G) is received.&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;A PIM router forwards (S,G) Joins towards the source when&lt;/p&gt;&lt;ul&gt;&lt;li&gt;The (S,G) has a valid outgoing interface list (olist) and the           router has RPF information for the source.&lt;/li&gt;&lt;/ul&gt;&lt;h2&gt;&lt;a name=&quot;pim&amp;#95;ssm&quot;&gt;&lt;/a&gt;PIM SSM&lt;/h2&gt;If IGMP knows the sources it wants to receive, it can inform it's router.  PIM can then forward joins directly to the source.  PIM-SSM takes this a step further by outlawing (*,G) state in the SSM range.  Not only isn't an RP required, it's prohibited.&lt;p&gt;232.0.0.0/8 is the default range for SSM, but it can be configured to any other range as well. Currently though 232/8 is hardwired in our (XR, IOS?) IGMP implementation, so no (*,G) IGMP reports will be accepted in that range.&lt;/p&gt;&lt;p&gt;These rules are directly from the PIM spec.&lt;/p&gt;&lt;ul&gt;&lt;li&gt;A router MUST NOT send a (*,G) Join/Prune message for any reason.&lt;/li&gt;&lt;li&gt;A router MUST NOT send an (S,G,rpt) Join/Prune message for any reason.&lt;/li&gt;&lt;li&gt;A router MUST NOT send a Register message for any packet that is  destined to an SSM address.&lt;/li&gt;&lt;li&gt;A router MUST NOT forward packets based on (*,G) or (S,G,rpt) state.   The (*,G) and (S,G,rpt) -related state summarization macros are NULL for any SSM address, for the purposes of packet forwarding.&lt;/li&gt;&lt;li&gt;A router acting as an RP MUST NOT forward any Register-encapsulated packet that has an SSM destination address&lt;/li&gt;&lt;/ul&gt;&lt;h2&gt;&lt;a name=&quot;pim-bidir&quot;&gt;&lt;/a&gt;PIM-BIDIR&lt;/h2&gt;PIM-BIDIR makes the RPT bidirectional.   The RP is the hub of all traffic, though traffic does not have to go all the way to the RP to reach local leaf nodes.  BIDIR forwards on (*,G) routes.&lt;p&gt;Simpler than PIM-SM.  No data driven events (eg, S,G creation based on data, KAT). &lt;/p&gt;&lt;p&gt;New sources are forwarded on the path to the RP (called the (*,G/M) route.&lt;/p&gt;&lt;p&gt;New (*,G) joins propagate towards the RP, and inherit accepting information from the RP.  The joins will create outgoing interface information – pointing back towards the LH (Last Hop).&lt;/p&gt;&lt;h2&gt;&lt;a name=&quot;msdp&quot;&gt;&lt;/a&gt;MSDP&lt;/h2&gt;MSDP listens to PIM register messages, and if PIM installs an L flag for the route in the MRIB, MSDP sends the traffic in the registers encapsulated in Source Active (SA) messages to it's configured peers. &lt;p&gt;If the remote RP has local receivers for the (S,G), it installs the route into the PIM topology table and forwards the traffic down the RPT.  The LH router performs SPT switchover.&lt;/p&gt;&lt;p&gt;If the remote RP has no local PIM interest in the SA, the SA stays in the MSDP cache but is not installed in PIM.&lt;/p&gt;&lt;p&gt;An SA contains the (S,G) info, the RP that originated the SA, and the encapsulated data sent in the register.&lt;/p&gt;&lt;p&gt;MSDP can be thought of as a poor man's BGP. It doesn't have ASs (so NO good loop avoidance), and it doesn't have policy other than filtering.  It uses the below set of rules to determine which peers to accept SAs from, based on the RP which originated the SA. connect-source == peer address used originator-id == RP address SA sent from.&lt;/p&gt;&lt;p&gt; 1) The MSDP peer P's connect-source is equal to the originator-id of the SA&lt;/p&gt;&lt;p&gt; 2) The MSDP peer P's connect-source is equal to the BGP NEXT_HOP of the active route for the originator-id of the SA&lt;/p&gt;&lt;p&gt; 3) a) The active route for the originator-id of the SA is known via BGP and the MSDP peer P's connect-source is equal to the BGP peering address of the peer who announced the route.&lt;/p&gt;&lt;p&gt;   b) The active route for the originator-id of the SA is known via ISIS/OSPF and the MSDP peer P's connect-source is equal to the IGP next hop for the route.&lt;/p&gt;&lt;p&gt; 4) The MSDP peer P's connect-source is in an AS in the AS&lt;i&gt;PATH of the active route for the originator-id of the SA, and has the highest IP address of the MSDP peer's connect-sources which reside in ASs in that AS&lt;/i&gt;PATH.&lt;/p&gt;&lt;p&gt;5) The MSDP peer P is configured as the static RPF-peer.&lt;/p&gt;
</description>
<pubDate>
Fri, 26 Jun 2009 00:00:00 +1200
</pubDate>
<author>
Andrés Gasson
</author>
</item>
<item>
<guid>
http://geek.red-elvis.net/posts/2009-05-29-ACLs.html
</guid>
<link>
http://geek.red-elvis.net/posts/2009-05-29-ACLs.html
</link>
<title>
Access Control Lists (ACLs)
</title>
<description>
 &lt;p&gt;ACLs don't do anything by themselves, they need to be applied somewhere.&lt;/p&gt;&lt;p&gt;ACLs are processed top-down, the first match causes a break and stop the processing of further entries (until a new packet needs to be processed).&lt;/p&gt;&lt;p&gt;Access lists contain an implicit &quot;deny any&quot; at end.&lt;/p&gt;&lt;p&gt;If an access-list that doesn't exist is specified, it is deemed to permit everything. For example if you do a &quot;ip access-group 100&quot; on an interface without creating ACL 100 first, everything will be permitted. BUT, as soon as you put in the first statement in that ACL, the implicit deny all at the end will come into play. So be careful on production equipment - ALWAYS remove the ACL from the interface first before playing with an ACL.&lt;/p&gt;&lt;p&gt;Applying a non-existent access-list can lead to serious problems when creating the corresponding ACL - because IOS configs are live, you will get erratic behavior.&lt;/p&gt;&lt;p&gt;ACLs use Wildcard Masks&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Wildcard masks are the binary reverse of subnet masks&lt;/li&gt;&lt;li&gt;Wildcard masks can be discontiguous (subnet masks cannot)&lt;/li&gt;&lt;li&gt;0 bit =&gt; must match bits in address&lt;/li&gt;&lt;li&gt;1 bit =&gt; don't care. No need to match bits in address&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;ACLs to filter traffic flows:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Only one ACL (that could have multiple entries) can be applied per L3protocol, per interface, per direction.&lt;/li&gt;&lt;li&gt;Inbound ACLs check the filter condition BEFORE routing table lookup&lt;/li&gt;&lt;li&gt;Outbound ACLs checks the filter condition AFTER routing table lookup&lt;/li&gt;&lt;/ul&gt;&lt;h4&gt;&lt;a name=&quot;general&amp;#95;recommendations:&quot;&gt;&lt;/a&gt;General Recommendations:&lt;/h4&gt;&lt;ul&gt;&lt;li&gt;Invest time and carefully place ACLs… consider bandwidth, CPU, etc.&lt;/li&gt;&lt;li&gt;Place the ACLs with the most hits at the top of the list if possible.&lt;/li&gt;&lt;li&gt;Create ACL first, then apply to interface.&lt;/li&gt;&lt;li&gt;Use Standard Access lists when filtering near dest.&lt;/li&gt;&lt;li&gt;Use Extended Access lists when filtering near Source, and/or need tospecify protocol, ports, etc.&lt;/li&gt;&lt;li&gt;Remember there is always an implicit &quot;deny all&quot; at end of any ACL. Itmight still be a good idea to put an explicit &quot;deny ip any any log&quot; statementfor troubleshooting purposes.&lt;/li&gt;&lt;/ul&gt;&lt;h3&gt;&lt;a name=&quot;numbered&amp;#95;acls&quot;&gt;&lt;/a&gt;Numbered ACLs&lt;/h3&gt;&lt;p&gt;Editing or re-ordering of numbered ACLs (other than adding lines at end) requires to drop the whole ACL and re-create it.&lt;/p&gt;&lt;p&gt;	Router(config)# access-list ?&lt;/p&gt;&lt;p&gt;|:------------|:-----------------------------------------:|:------------------------| |&lt;strong&gt;Range&lt;/strong&gt; | &lt;strong&gt;Description&lt;/strong&gt; | &lt;strong&gt;Notes&lt;/strong&gt; |&lt;1-99&gt;|IP standard access list|Match on source address ONLY.| |&lt;100-199&gt;|IP extended access list|Match on source &amp; dest. address, protocol, port, etc.| |&lt;200-299&gt;|Protocol type-code access list|Match on Ethernet protocol type-codes| |&lt;300-399&gt;|DECnet access list| |&lt;400-499&gt;|XNS standard access list| |&lt;500-599&gt;|XNS extended access list| |&lt;600-699&gt;|Appletalk access list| |&lt;700-799&gt;|48-bit MAC address access list| |&lt;800-899&gt;|IPX standard access list| |&lt;900-999&gt;|IPX extended access list |&lt;1000-1099&gt;|IPX SAP access list |&lt;1100-1199&gt;|Extended 48-bit MAC address access list |&lt;1200-1299&gt;|IPX summary address access list |&lt;1300-1999&gt;|IP standard access list (expanded range)|Same as &lt;1-99&gt; |&lt;2000-2699&gt;|IP extended access list (expanded range)|Same as &lt;100-199&gt;&lt;/p&gt;&lt;h4&gt;&lt;a name=&quot;dynamic-extended&quot;&gt;&lt;/a&gt;dynamic-extended&lt;/h4&gt;&lt;p&gt;Extend the dynamic ACL absolute timer&lt;/p&gt;&lt;h4&gt;&lt;a name=&quot;rate-limit&quot;&gt;&lt;/a&gt;rate-limit&lt;/h4&gt;&lt;p&gt;Simple rate-limit specific access list&lt;/p&gt;&lt;h3&gt;&lt;a name=&quot;named&amp;#95;acls&quot;&gt;&lt;/a&gt;Named ACLs&lt;/h3&gt;&lt;p&gt;Named ACLs permit deleting specific lines. But they are not supported with every feature (yet).&lt;/p&gt;&lt;p&gt;Router(config)# ip access-list ?&lt;/p&gt;&lt;p&gt;|:------------|:-----------------------------------------:| |&lt;strong&gt;Option&lt;/strong&gt;|&lt;strong&gt;Description&lt;/strong&gt; |standard|Standard Access List |extended|Extended Access List |logging|Control access list logging |log-update|Control access list log updates&lt;/p&gt;&lt;h2&gt;&lt;a name=&quot;configuration&quot;&gt;&lt;/a&gt;Configuration&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;Standard&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;	access-list 10 permit 192.168.1.0 0.0.0.255 	! 	interface FastEthernet 0/0 	access-group 10 in&lt;/p&gt;&lt;p&gt;&lt;strong&gt;Extended&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;	access-list 100 permit ip 192.168.1.0 0.0.0.255 172.16.1.0 0.0.255&lt;/p&gt;&lt;p&gt;&lt;strong&gt;Named&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;	ip access-list&lt;/p&gt;&lt;p&gt;&lt;strong&gt;Dynamic&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;Time-Based&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;CBAC (Content Based Access Control)&lt;/strong&gt;&lt;/p&gt;&lt;h3&gt;&lt;a name=&quot;traffic&amp;#95;filtering&quot;&gt;&lt;/a&gt;Traffic Filtering&lt;/h3&gt;&lt;p&gt;CBAC intelligently filters TCP and UDP packets based on application-layer protocol session information. You can configure CBAC to permit specified TCP and UDP traffic through a firewall only when the connection is initiated from within the network you want to protect.&lt;/p&gt;&lt;p&gt;CBAC examines not only network layer and transport layer information but also examines the application-layer protocol information (such as FTP connection information) to learn about the state of the session. This allows support of protocols that involve multiple channels created as a result of negotiations in the control channel. Most of the multimedia protocols as well as some other protocols (such as FTP, RPC, and SQL*Net) involve multiple channels.&lt;/p&gt;&lt;p&gt;Java blocking can be configured to filter HTTP traffic based on the server address or to completely deny access to Java applets that are not embedded in an archived or compressed file.&lt;/p&gt;&lt;h3&gt;&lt;a name=&quot;traffic&amp;#95;inspection&quot;&gt;&lt;/a&gt;Traffic Inspection&lt;/h3&gt;&lt;p&gt;CBAC inspects traffic that travels through the firewall to discover and manage state information for TCP and UDP sessions. This state information is used to create temporary openings in the firewall's access lists to allow return traffic and additional data connections for permissible sessions.&lt;/p&gt;&lt;p&gt;Inspecting packets at the application layer, and maintaining TCP and UDP session information, provides CBAC with the ability to detect and prevent certain types of network attacks such as SYN-flooding.&lt;/p&gt;&lt;p&gt;CBAC helps to protect against DoS attacks in other ways. CBAC inspects packet sequence numbers in TCP connections to see if they are within expected ranges --CBAC drops any suspicious packets. You can also configure CBAC to drop half- open connections, which require firewall processing and memory resources to maintain. Additionally, CBAC can detect unusually high rates of new connections and issue alert messages. CBAC can help by protecting against certain DoS attacks involving fragmented IP packets.&lt;/p&gt;&lt;h3&gt;&lt;a name=&quot;alerts&amp;#95;and&amp;#95;audit&amp;#95;trails&quot;&gt;&lt;/a&gt;Alerts and Audit Trails&lt;/h3&gt;&lt;p&gt;Using CBAC inspection rules, you can configure alerts and audit trail information on a per-application protocol basis.&lt;/p&gt;&lt;h3&gt;&lt;a name=&quot;intrusion&amp;#95;detection&quot;&gt;&lt;/a&gt;Intrusion Detection&lt;/h3&gt;&lt;p&gt;CBAC provides a limited amount of intrusion detection to protect against specific SMTP attacks. With intrusion detection, SYSLOG messages are reviewed and monitored for specific &quot;attack signatures.&quot; Certain types of network attacks have specific characteristics, or signatures. When CBAC detects an attacks, it resets the offending connections and sends SYSLOG information to the SYSLOG server.&lt;/p&gt;&lt;h2&gt;&lt;a name=&quot;configuration&quot;&gt;&lt;/a&gt;Configuration&lt;/h2&gt;	!	ip inspect tcp idle-time 30	ip inspect name myCBAC tcp	ip inspect name myCBAC udp	ip inspect name myCBAC icmp	ip inspect name myCBAC http	ip inspect name myCBAC ftp	ip inspect name myCBAC smtp	ip inspect name myCBAC http java-list 1&lt;p&gt;Only allow java applets downloaded from network 3.0.0.0&lt;/p&gt;&lt;p&gt;	! 	interface Serial0/3 	 ip address 2.0.0.1 255.0.0.0 	 ip access-group 100 in&lt;/p&gt;&lt;p&gt;Permit certain types of necessary control traffic in but deny everything else.&lt;/p&gt;&lt;p&gt;	 ip inspect myCBAC out&lt;/p&gt;&lt;p&gt;Permit the return traffic in - as specified by CBAC.&lt;/p&gt;&lt;p&gt;	access-list 100 permit udp any any eq rip&lt;/p&gt;&lt;p&gt;	access-list 100 deny ip any any&lt;/p&gt;&lt;p&gt;	access-list 1 permit 3.0.0.0 0.255.255.255 	! 	ip port-map http 8000 list 40 	#Map HTTP to port 8000 for internal hosts 192.16.1.0 through .15 	ip port-map http 8080 	#Map HTTP globally to port 8080 for other hosts 	ip port-map ftp 8021 	#Map FTP globally to port 8021 	access-list 40 permit 192.16.1.0  0.0.0.15&lt;/p&gt;&lt;ul&gt;&lt;li&gt;In the CCIE lab, set both the max-incomplete and one-minute threshold ifasked to configure CBAC.     ip inspect max-incomplete high 1000&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;Start deleting half open connections if they reach 1000.&lt;/p&gt;&lt;pre&gt;&lt;code&gt; ip inspect max-incomplete low 800
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Stop deleting half open connections if they reach 800.&lt;/p&gt;&lt;pre&gt;&lt;code&gt; ip inspect one-minute high 500
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Start deleting half open connections if they reach 500 in the last minute.&lt;/p&gt;&lt;pre&gt;&lt;code&gt; ip inspect one-minute low 400
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Stop deleting half open connections if they reach 400 in the last minute.&lt;/p&gt;&lt;pre&gt;&lt;code&gt; ip inspect tcp max-incomplete host 50 block 5
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Allow a maximum of incomplete connections of 50 per host. Block the host for 5 minutes if that treshold is reached..&lt;/p&gt;&lt;pre&gt;&lt;code&gt;ip inspect tcp finwait-time
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;?&lt;/p&gt;&lt;pre&gt;&lt;code&gt;ip inspect tcp synwait-time 20
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Wait 20 seconds before terminating a half=open connection.&lt;/p&gt;&lt;pre&gt;&lt;code&gt;ip inspect tcp idle-time 300
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Delete TCP connections when idle for 300 seconds.&lt;/p&gt;&lt;pre&gt;&lt;code&gt;ip inspect udp idle-time 300
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;?&lt;/p&gt;&lt;h2&gt;&lt;a name=&quot;links&quot;&gt;&lt;/a&gt;Links&lt;/h2&gt;&lt;ul&gt;&lt;li&gt;[Configuring Context-Based Access Control ][1]&lt;/li&gt;&lt;li&gt;[Two-Interface Router with NAT CBAC Configuration][2]&lt;/li&gt;&lt;li&gt;[Auth-proxy Authentication Inbound (CBAC, no NAT) Configuration][3]&lt;/li&gt;&lt;li&gt;&lt;a href='http://www.cisco.com/en/US/products/sw/secursw/ps1018/products&lt;i&gt;qanda&lt;/i&gt;i'&gt;CBAC FAQ &lt;/a&gt;&lt;/li&gt;&lt;li&gt;[Benefits and Limitations of Context-Based Access Control][5]&lt;/li&gt;&lt;li&gt;&lt;a href='http://www.cisco.com/univercd/cc/td/doc/product/software/ios122/122cgc'&gt;Configuring Port to Application Mapping&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h2&gt;&lt;a name=&quot;links&quot;&gt;&lt;/a&gt;Links&lt;/h2&gt;&lt;p&gt;&lt;a href='http://www.cisco.com/warp/public/707/confaccesslists.html'&gt;Configuring IP Access Lists&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;a href='http://www.cisco.com/warp/public/105/ACLsamples.html'&gt;Configuring Commonly Used IP ACLs&lt;/a&gt;&lt;/p&gt;&lt;p&gt;[Cisco IOS Access-Lists (O'Reilly Book Sample Chapter) ][9]&lt;/p&gt;&lt;h2&gt;&lt;a name=&quot;reflexive&amp;#95;acls&quot;&gt;&lt;/a&gt;Reflexive ACLs&lt;/h2&gt;&lt;h3&gt;&lt;a name=&quot;information&quot;&gt;&lt;/a&gt;Information&lt;/h3&gt;&lt;ul&gt;&lt;li&gt;Anything that can be done with reflexive ACL's can be done with CBAC -except that CBAC requires IOS FW Feature set.&lt;/li&gt;&lt;li&gt;In order of growing safety: (1) established (2) reflexive (3) CBAC&lt;/li&gt;&lt;li&gt;Reflexive access-lists (also called IP Session Filtering) is a form ofsession filetring that dynamically create openings to permit the returntraffic from a connection.&lt;/li&gt;&lt;li&gt;Reflexive ACLs requires a named extended ACL. Reflexive access lists canbe defined with extended named IP access lists only. You cannot definereflexive access lists with numbered or standard named IP access lists or withother protocol access lists.&lt;/li&gt;&lt;li&gt;The reflexive access-list is used in conjunction to another access-list itis evaluated against.&lt;/li&gt;&lt;li&gt;You can use reflexive access lists in conjunction with other standardaccess lists and static extended access lists.&lt;/li&gt;&lt;li&gt;With reflexive, be careful with timers. &quot;ip reflexive-list timeout&quot;default is 300 sec. Alternatively, it can be specified on each entry of theACL or globally.&lt;/li&gt;&lt;li&gt;The reflected ACL doesn't need to be placed at the end of the list.&lt;/li&gt;&lt;li&gt;You can use &quot;show access-lists&quot; while a connection is happening to see thedynamically created entries.&lt;/li&gt;&lt;/ul&gt;&lt;h3&gt;&lt;a name=&quot;configuration&quot;&gt;&lt;/a&gt;Configuration&lt;/h3&gt;&lt;pre&gt;&lt;code&gt;interface Ethernet 0/0
  ip address 192.168.1.1 255.255.255.0
  ip access-group comingIn in
  ip access-group goingOut out
!
ip access-list extended comingIn
  permit udp any any eq rip
 evaluate myPackets
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&quot;myPackets&quot; will be the name of the reflexive ACL - it will be appended to ACL ComingIn&lt;/p&gt;&lt;pre&gt;&lt;code&gt;ip access-list extended goingOut
 permit tcp any any eq telnet reflect myPackets timeout 300
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;With per ACL timeout (in seconds)&lt;/p&gt;&lt;pre&gt;&lt;code&gt;ip reflexive-list timeout 600
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Global timeout (in seconds )&lt;/p&gt;&lt;h3&gt;&lt;a name=&quot;links&quot;&gt;&lt;/a&gt;Links&lt;/h3&gt;&lt;p&gt;[Configuring IP Session Filtering (Reflexive Access Lists)][10]&lt;/p&gt;&lt;h3&gt;&lt;a name=&quot;appendix&quot;&gt;&lt;/a&gt;Appendix&lt;/h3&gt;&lt;ul&gt;&lt;li&gt;With basic standard and static extended access lists, you can approximatesession filtering by using the established keyword with the permit command.The established keyword filters TCP packets based on whether the ACK or RSTbits are set. (Set ACK or RST bits indicate that the packet is not the firstin the session, and therefore, that the packet belongs to an establishedsession.) There are two main caveats to doing this: (1) the filter criterionwould be part of an access list applied permanently to an interface and (2) itonly applies to TCP, not UDP.&lt;/li&gt;&lt;li&gt;In order of growing safety: (1) established (2) reflexive (3) CBAC&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;Established ACL that permits the return traffic of established telnet connections.&lt;/p&gt;&lt;pre&gt;&lt;code&gt;interface Serial0/3
 ip address 2.0.0.1 255.0.0.0
 ip access-group 100 in
&lt;/code&gt;&lt;/pre&gt;&lt;pre&gt;&lt;code&gt;access-list 100 permit tcp any eq telnet any established
access-list 100 permit udp any any eq rip&amp;lt;br&amp;gt; access-list 100 deny ip any any
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;With basic standard and static extended access lists, you can approximate session filtering by using the established keyword with the permit command. The established keyword filters TCP packets based on whether the ACK or RST bits are set. (Set ACK or RST bits indicate that the packet is not the first in the session, and therefore, that the packet belongs to an established session.) There are two main caveats to doing this: (1) the filter criterion would be part of an access list applied permanently to an interface and (2) it only applies to TCP, not UDP. Reflexive ACLs are better in those regards and should be used for more complete solutions.&lt;/p&gt;&lt;ul&gt;&lt;li&gt;In order of growing safety: (1) established (2) reflexive (3) CBAC&lt;/li&gt;&lt;li&gt;CBAC can be used to filter java applets AND SYN attacks.&lt;/li&gt;&lt;li&gt;CBAC doesn't work with ICMP. You must use regular ACLs for that.&lt;/li&gt;&lt;li&gt;It the test specify for high/low timers/counts. Do it for both max-incomplete and one minute values.&lt;/li&gt;&lt;li&gt;Regular ACLs are applied BEFORE CBAC.&lt;/li&gt;&lt;li&gt;Put an explicit deny/log at the end of ACLs to make sure the filter isworking right.&lt;/li&gt;&lt;li&gt;Only CBAC can do multiport applications simply and correctly (like FTPTCP20/21).&lt;/li&gt;&lt;li&gt;The &quot;ip inspect&quot; statement can be put on either the inside interfaceinbound or outside interface outbound, depending on the desired result (dmz,etc.).&lt;/li&gt;&lt;li&gt;You can use &quot;show access-lists&quot; while a connection is happening to see thedynamically created entries.&lt;/li&gt;&lt;li&gt;CBAC works with CEF, fast switching and process switching.&lt;/li&gt;&lt;li&gt;For firewall FS, the keys are: ip inspect, ip auth-proxy, and ip audit /ip ips&lt;/li&gt;&lt;li&gt;Netmeeting also required generic TCP inspection in addition of H.323 (&quot;ipinspect name myCBAC tcp&quot;)&lt;/li&gt;&lt;li&gt;IOS cannot do both SMTP and ESMTP. Use ESMTP to support both.&lt;/li&gt;&lt;li&gt;When doing port-map, the ports are additive - if you add a custom port-map, it adds to the existing port (NBAR is replacive)&lt;/li&gt;&lt;/ul&gt;r/fsecur_c/ftrafwl/scfcbac.htmration_example09186a0080094110.shtmlration_example09186a00800942ff.shtmltem09186a008009464d.shtmlr/fsecur_c/ftrafwl/scfpam.htm#1000871ed&lt;i&gt;cr/secur&lt;/i&gt;c/scprt3/screflex.htm
</description>
<pubDate>
Fri, 29 May 2009 00:00:00 +1200
</pubDate>
<author>
Andrés Gasson
</author>
</item>
<item>
<guid>
http://geek.red-elvis.net/posts/2009-03-21-bgp.html
</guid>
<link>
http://geek.red-elvis.net/posts/2009-03-21-bgp.html
</link>
<title>
BGP Notes
</title>
<description>
&lt;h1&gt;&lt;a name=&quot;bgp&quot;&gt;&lt;/a&gt;BGP&lt;/h1&gt;&lt;h2&gt;&lt;a name=&quot;information&quot;&gt;&lt;/a&gt;Information&lt;/h2&gt;&lt;ul&gt;&lt;li&gt;Each BGP entry takes about 240 bytes of memory in the BGP table and another 240 bytes in the IP routing table. Each path takes about 110 bytes.&lt;/li&gt;&lt;li&gt;BGP uses TCP port 179.&lt;/li&gt;&lt;li&gt;BGP is connection oriented. As long as one side can establish the connection, it will work.&lt;/li&gt;&lt;li&gt;Private AS numbers: 64512-65535 (last 1024 of 16 bit block)&lt;/li&gt;&lt;/ul&gt;&lt;h3&gt;&lt;a name=&quot;bgp&amp;#95;route&amp;#95;selection&amp;#95;process&quot;&gt;&lt;/a&gt;BGP Route Selection Process&lt;/h3&gt;&lt;ul&gt;&lt;li&gt;Only consider paths with reachable NEXT_HOP attributes&lt;/li&gt;&lt;li&gt;Do not consider iBGP path if not synchronized&lt;/li&gt;&lt;li&gt;Highest WEIGHT&lt;/li&gt;&lt;li&gt;Highest LOCAL_PREF&lt;/li&gt;&lt;li&gt;Prefer locally originated route4.  Shortest AS_PATH&lt;/li&gt;&lt;li&gt;Lowest ORIGIN code (IGP &amp;lt; EGP &amp;lt; incomplete)&lt;/li&gt;&lt;li&gt;Lowest Multi-Exit Discriminator (MED)&lt;ol&gt;&lt;li&gt;IF bgp deterministic-med, order the paths before comparing2.  IF bgp always-compare-med, then compare it for all paths&lt;/li&gt;&lt;/ol&gt;&lt;/li&gt;&lt;li&gt;Considered only if paths are from the same neighbor AS&lt;/li&gt;&lt;/ol&gt;&lt;/li&gt;&lt;li&gt;Prefer an External path over an Internal one&lt;/li&gt;&lt;li&gt;Lowest IGP metric to the NEXT_HOP&lt;/li&gt;&lt;li&gt;IF multipath is enabled, the router may install up to N parallel paths in the routing table&lt;/li&gt;&lt;li&gt;For eBGP paths, select the &amp;#8220;oldest&amp;#8221; (To minimize route-flap)&lt;/li&gt;&lt;li&gt;Lowest Router-ID (Originator-ID is considered for reflected routes)&lt;/li&gt;&lt;li&gt;Shortest Cluster-List (Client must be aware of RR attributes!)&lt;/li&gt;&lt;li&gt;Lowest neighbor IP address&lt;/li&gt;&lt;/ul&gt;&lt;h4&gt;&lt;a name=&quot;ibgp&quot;&gt;&lt;/a&gt;iBGP&lt;/h4&gt;&lt;ul&gt;&lt;li&gt;The NEXT_HOP attribute is not updated when a prefix is sent to an iBGP peer. You can use &amp;quot;next-hop-self&amp;quot; on the neighbor statement to solve any issues caused by that feature.&lt;/li&gt;&lt;li&gt;Applies the rule of iBGP split-horizon - an iBGP received prefix will not be propagated to another iBGP neighbor. Hence, iBGP requires a full mesh between BGP peers. There are two ways to circumvent this requirement:&lt;ol&gt;&lt;li&gt;Route Reflectors (route server)&lt;/li&gt;&lt;/ol&gt;&lt;/li&gt;&lt;li&gt;Confederations (sub ASes)&lt;/li&gt;&lt;/ol&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h4&gt;&lt;a name=&quot;ebgp&quot;&gt;&lt;/a&gt;eBGP&lt;/h4&gt;&lt;ul&gt;&lt;li&gt;The NEXT_HOP attribute is updated when a prefix is sent to an eBGP peer (but NOT if it is a  member of the same confederation).&lt;/li&gt;&lt;li&gt;By default the eBGP neighbor is assumed to be directly connected. Consequently, the &amp;quot;neighbor ebgp-multihop&amp;quot; command MUST be used if the peers are not directly connected. Note: loopbacks are never directly connected - so you need to use either ebgp-multihop or disable-connected-check when peering eBGP on loopbacks...&lt;/li&gt;&lt;/ul&gt;&lt;h4&gt;&lt;a name=&quot;route-reflectors&quot;&gt;&lt;/a&gt;Route-Reflectors&lt;/h4&gt;&lt;ul&gt;&lt;li&gt;The NEXT_HOP attribute is preserved (same as iBGP). Because of this, if a route-reflector client is peering with an eBGP peer, you will most likely have to change the next hop to reflect the address of the RRC. That is unless you redistribute the connected external routes, of course.&lt;/li&gt;&lt;/ul&gt;&lt;h4&gt;&lt;a name=&quot;confederations&quot;&gt;&lt;/a&gt;Confederations&lt;/h4&gt;&lt;ul&gt;&lt;li&gt;The NEXT&lt;i&gt;HOP attribute is preserved between confederation members - this is differerent from a traditional eBGP peering session.*   The MULTI&lt;/i&gt;EXIT_DESC is preserved&lt;/li&gt;&lt;li&gt;The LOCAL_PREF is preserved&lt;/li&gt;&lt;/ul&gt;&lt;h4&gt;&lt;a name=&quot;communities&quot;&gt;&lt;/a&gt;Communities&lt;/h4&gt;&lt;p&gt;The community attribute is a transitive, optional attribute designed to group destinations in a certain community and apply certain policies (such as accept, prefer, or redistribute). The following table shows the well known BGP communities.&lt;/p&gt;&lt;pre&gt;&lt;code&gt;   &amp;lt;table width=&amp;quot;100%&amp;quot; border=&amp;quot;1&amp;quot; cellpadding=&amp;quot;2&amp;quot; cellspacing=&amp;quot;0&amp;quot; bgcolor=&amp;quot;#ffffff&amp;quot; class=&amp;quot;tiny&amp;quot;&amp;gt;
     &amp;lt;tbody&amp;gt;
       &amp;lt;tr&amp;gt;
         &amp;lt;th height=&amp;quot;&amp;quot; width=&amp;quot;20%&amp;quot; bgcolor=&amp;quot;#ccccff&amp;quot; colspan=&amp;quot;1&amp;quot; rowspan=&amp;quot;1&amp;quot;&amp;gt; 
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;span class=&quot;content&quot;&gt;Community&lt;/span&gt; &lt;/th&gt;&lt;pre&gt;&lt;code&gt;         &amp;lt;th height=&amp;quot;&amp;quot; width=&amp;quot;80%&amp;quot; bgcolor=&amp;quot;#ccccff&amp;quot; colspan=&amp;quot;1&amp;quot; rowspan=&amp;quot;1&amp;quot;&amp;gt;  
&lt;/code&gt;&lt;/pre&gt;&lt;span class=&quot;content&quot;&gt;Description&lt;/span&gt; &lt;/th&gt;&lt;/p&gt;&lt;pre&gt;&lt;code&gt;       &amp;lt;/tr&amp;gt;
       &amp;lt;tr valign=&amp;quot;top&amp;quot;&amp;gt;
         &amp;lt;td height=&amp;quot;&amp;quot; colspan=&amp;quot;1&amp;quot; bgcolor=&amp;quot;#ffffff&amp;quot;&amp;gt;AS:VAL&amp;lt;/td&amp;gt;
         &amp;lt;td height=&amp;quot;&amp;quot; colspan=&amp;quot;1&amp;quot; bgcolor=&amp;quot;#ffffff&amp;quot;&amp;gt; This format represents 4 octet communities value. `AS` is high order 2 octet in digit format. `VAL` is low order 2 octet in digit format. This format is useful to define AS oriented policy value. For example, &amp;lt;span class=&amp;quot;code&amp;quot;&amp;gt;7675:80&amp;lt;/span&amp;gt; can be used when AS 7675 wants to pass local policy value 80 to neighboring peer. &amp;lt;/td&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;pre&gt;&lt;code&gt;       &amp;lt;/tr&amp;gt;
       &amp;lt;tr valign=&amp;quot;top&amp;quot;&amp;gt;
         &amp;lt;td width=&amp;quot;20%&amp;quot; height=&amp;quot;&amp;quot; colspan=&amp;quot;1&amp;quot; rowspan=&amp;quot;1&amp;quot; bgcolor=&amp;quot;#ffffff&amp;quot;&amp;gt;&amp;lt;span class=&amp;quot;content&amp;quot;&amp;gt;LOCAL-AS&amp;lt;/span&amp;gt;&amp;lt;/td&amp;gt;
         &amp;lt;td width=&amp;quot;80%&amp;quot; height=&amp;quot;&amp;quot; colspan=&amp;quot;1&amp;quot; rowspan=&amp;quot;1&amp;quot; bgcolor=&amp;quot;#ffffff&amp;quot;&amp;gt;&amp;lt;span class=&amp;quot;content&amp;quot;&amp;gt;Use in confederation scenarios to prevent sending packets outside the local autonomous system &amp;#40;AS&amp;#41;.
               &amp;lt;/span&amp;gt;&amp;lt;span class=&amp;quot;code&amp;quot;&amp;gt;local-AS&amp;lt;/span&amp;gt;&amp;lt;span class=&amp;quot;content&amp;quot;&amp;gt; represents well-known communities value &amp;lt;/span&amp;gt;&amp;lt;span class=&amp;quot;code&amp;quot;&amp;gt;NO&amp;#95;EXPORT&amp;#95;SUBCONFED&amp;lt;/span&amp;gt;&amp;lt;span class=&amp;quot;content&amp;quot;&amp;gt; &amp;#40;0xFFFFFF03&amp;#41;. All routes carry this value must not be advertised to external BGP peers. Even if the neighboring router is part of confederation, it is considered as external BGP peer, so the route will not be announced to the peer. &amp;lt;/span&amp;gt;&amp;lt;/td&amp;gt;
       &amp;lt;/tr&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;pre&gt;&lt;code&gt;       &amp;lt;tr valign=&amp;quot;top&amp;quot;&amp;gt;
         &amp;lt;td width=&amp;quot;20%&amp;quot; height=&amp;quot;&amp;quot; colspan=&amp;quot;1&amp;quot; rowspan=&amp;quot;1&amp;quot; bgcolor=&amp;quot;#ffffff&amp;quot;&amp;gt;&amp;lt;span class=&amp;quot;content&amp;quot;&amp;gt;NO-EXPORT&amp;lt;/span&amp;gt;&amp;lt;/td&amp;gt;
         &amp;lt;td width=&amp;quot;80%&amp;quot; height=&amp;quot;&amp;quot; colspan=&amp;quot;1&amp;quot; rowspan=&amp;quot;1&amp;quot; bgcolor=&amp;quot;#ffffff&amp;quot;&amp;gt;Do not advertise to external BGP &amp;#40;eBGP&amp;#41; peers. Keep this route within an AS. 
           &amp;lt;span class=&amp;quot;code&amp;quot;&amp;gt;no-export&amp;lt;/span&amp;gt; represents well-known communities value &amp;lt;span class=&amp;quot;code&amp;quot;&amp;gt;NO&amp;#95;EXPORT&amp;lt;/span&amp;gt; &amp;#40;0xFFFFFF01&amp;#41;. All routes carry this value must not be advertised to outside a BGP confederation boundary. If neighboring BGP peer is part of BGP confederation, the peer is considered as inside a BGP confederation boundary, so the route will be announced to the peer. &amp;lt;/td&amp;gt;
       &amp;lt;/tr&amp;gt;
       &amp;lt;tr valign=&amp;quot;top&amp;quot;&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;pre&gt;&lt;code&gt;         &amp;lt;td width=&amp;quot;20%&amp;quot; height=&amp;quot;&amp;quot; colspan=&amp;quot;1&amp;quot; rowspan=&amp;quot;1&amp;quot; bgcolor=&amp;quot;#ffffff&amp;quot;&amp;gt;&amp;lt;span class=&amp;quot;content&amp;quot;&amp;gt;NO-ADVERTISE&amp;lt;/span&amp;gt;&amp;lt;/td&amp;gt;
         &amp;lt;td width=&amp;quot;80%&amp;quot; height=&amp;quot;&amp;quot; colspan=&amp;quot;1&amp;quot; rowspan=&amp;quot;1&amp;quot; bgcolor=&amp;quot;#ffffff&amp;quot;&amp;gt;&amp;lt;span class=&amp;quot;content&amp;quot;&amp;gt;Do not advertise this route to any peer, internal or external. 
             &amp;lt;/span&amp;gt;&amp;lt;span class=&amp;quot;code&amp;quot;&amp;gt;no-advertise&amp;lt;/span&amp;gt;&amp;lt;span class=&amp;quot;content&amp;quot;&amp;gt; represents well-known communities value &amp;lt;/span&amp;gt;&amp;lt;span class=&amp;quot;code&amp;quot;&amp;gt;NO&amp;#95;ADVERTISE&amp;lt;/span&amp;gt;&amp;lt;span class=&amp;quot;content&amp;quot;&amp;gt; &amp;#40;0xFFFFFF02&amp;#41;. All routes carry this value must not be advertise to other BGP peers. &amp;lt;/span&amp;gt;&amp;lt;/td&amp;gt;
       &amp;lt;/tr&amp;gt;
       &amp;lt;tr valign=&amp;quot;top&amp;quot;&amp;gt;
         &amp;lt;td width=&amp;quot;20%&amp;quot; height=&amp;quot;&amp;quot; colspan=&amp;quot;1&amp;quot; rowspan=&amp;quot;1&amp;quot; bgcolor=&amp;quot;#ffffff&amp;quot;&amp;gt;&amp;lt;span class=&amp;quot;content&amp;quot;&amp;gt;INTERNET&amp;lt;/span&amp;gt;&amp;lt;/td&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;pre&gt;&lt;code&gt;         &amp;lt;td width=&amp;quot;80%&amp;quot; height=&amp;quot;&amp;quot; colspan=&amp;quot;1&amp;quot; rowspan=&amp;quot;1&amp;quot; bgcolor=&amp;quot;#ffffff&amp;quot;&amp;gt;&amp;lt;span class=&amp;quot;content&amp;quot;&amp;gt;Advertise this route to the internet community, and any router that belongs to it. 
         &amp;lt;/span&amp;gt;&amp;lt;span class=&amp;quot;code&amp;quot;&amp;gt;internet&amp;lt;/span&amp;gt;&amp;lt;span class=&amp;quot;content&amp;quot;&amp;gt; represents well-known communities value 0. &amp;lt;/span&amp;gt;&amp;lt;/td&amp;gt;
       &amp;lt;/tr&amp;gt;
       &amp;lt;tr valign=&amp;quot;top&amp;quot;&amp;gt;
         &amp;lt;td height=&amp;quot;&amp;quot; colspan=&amp;quot;1&amp;quot; rowspan=&amp;quot;1&amp;quot; bgcolor=&amp;quot;#ffffff&amp;quot;&amp;gt;&amp;lt;span class=&amp;quot;content&amp;quot;&amp;gt;NONE&amp;lt;/span&amp;gt;&amp;lt;/td&amp;gt;
         &amp;lt;td height=&amp;quot;&amp;quot; colspan=&amp;quot;1&amp;quot; rowspan=&amp;quot;1&amp;quot; bgcolor=&amp;quot;#ffffff&amp;quot;&amp;gt;&amp;lt;span class=&amp;quot;content&amp;quot;&amp;gt;Apply no community attribute when you want to clear the communities associated with a route.&amp;lt;/span&amp;gt;&amp;lt;/td&amp;gt;
       &amp;lt;/tr&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;pre&gt;&lt;code&gt;     &amp;lt;/tbody&amp;gt;
   &amp;lt;/table&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;h2&gt;&lt;a name=&quot;configuration&quot;&gt;&lt;/a&gt;Configuration&lt;/h2&gt;&lt;pre&gt;&lt;code&gt;   &amp;lt;table width=&amp;quot;100%&amp;quot; border=&amp;quot;0&amp;quot; cellpadding=&amp;quot;0&amp;quot; cellspacing=&amp;quot;2&amp;quot; class=&amp;quot;tiny&amp;quot;&amp;gt;
     &amp;lt;tr valign=&amp;quot;top&amp;quot;&amp;gt;
       &amp;lt;td width=&amp;quot;50%&amp;quot; class=&amp;quot;code&amp;quot;&amp;gt;neighbor 1.1.1.1 remove-private-as &amp;lt;/td&amp;gt;
       &amp;lt;td width=&amp;quot;50%&amp;quot;&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Remove private ASN from AS_PATH before sending to neighbor 1.1.1.1 (always done on the outbound)  &lt;/td&gt;&lt;/p&gt;&lt;pre&gt;&lt;code&gt;     &amp;lt;/tr&amp;gt;
     &amp;lt;tr valign=&amp;quot;top&amp;quot;&amp;gt;
       &amp;lt;td class=&amp;quot;code&amp;quot;&amp;gt;&amp;amp;nbsp;&amp;lt;/td&amp;gt;
       &amp;lt;td&amp;gt;&amp;amp;nbsp;&amp;lt;/td&amp;gt;
     &amp;lt;/tr&amp;gt;
     &amp;lt;tr valign=&amp;quot;top&amp;quot;&amp;gt;
       &amp;lt;td class=&amp;quot;code&amp;quot;&amp;gt; bgp confederation identifier 123
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;pre&gt;&lt;code&gt;       &amp;lt;td&amp;gt;Make this router/AS a member of confederation 123 &amp;lt;/td&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;pre&gt;&lt;code&gt;     &amp;lt;/tr&amp;gt;
     &amp;lt;tr valign=&amp;quot;top&amp;quot;&amp;gt;
       &amp;lt;td class=&amp;quot;code&amp;quot;&amp;gt;bgp confederation peers 1 2 &amp;lt;/td&amp;gt;
       &amp;lt;td&amp;gt;List the AS belonging to confederation 123&amp;lt;/td&amp;gt;
     &amp;lt;/tr&amp;gt;
     &amp;lt;tr valign=&amp;quot;top&amp;quot;&amp;gt;
       &amp;lt;td class=&amp;quot;code&amp;quot;&amp;gt;&amp;amp;nbsp;&amp;lt;/td&amp;gt;
       &amp;lt;td&amp;gt;&amp;amp;nbsp;&amp;lt;/td&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;pre&gt;&lt;code&gt;     &amp;lt;/tr&amp;gt;
     &amp;lt;tr valign=&amp;quot;top&amp;quot;&amp;gt;
       &amp;lt;td class=&amp;quot;code&amp;quot;&amp;gt;. &amp;#40;period&amp;#41; &amp;lt;/td&amp;gt;
       &amp;lt;td&amp;gt;Match any single character, including white space &amp;lt;/td&amp;gt;
     &amp;lt;/tr&amp;gt;
     &amp;lt;tr valign=&amp;quot;top&amp;quot;&amp;gt;
       &amp;lt;td class=&amp;quot;code&amp;quot;&amp;gt;&amp;#42; &amp;#40;asterisk&amp;#41; &amp;lt;/td&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;pre&gt;&lt;code&gt;       &amp;lt;td&amp;gt;Matches 0 or more occurence of the pattern &amp;lt;/td&amp;gt;
     &amp;lt;/tr&amp;gt;
     &amp;lt;tr valign=&amp;quot;top&amp;quot;&amp;gt;
       &amp;lt;td class=&amp;quot;code&amp;quot;&amp;gt;+ &amp;#40;plus&amp;#41; &amp;lt;/td&amp;gt;
       &amp;lt;td&amp;gt;Matches 1 or more occurence of the pattern &amp;lt;/td&amp;gt;
     &amp;lt;/tr&amp;gt;
     &amp;lt;tr valign=&amp;quot;top&amp;quot;&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;pre&gt;&lt;code&gt;       &amp;lt;td class=&amp;quot;code&amp;quot;&amp;gt;? &amp;#40;question mark&amp;#41; &amp;lt;/td&amp;gt;
       &amp;lt;td&amp;gt;Matches 0 or 1 occurence of the pattern &amp;lt;/td&amp;gt;
     &amp;lt;/tr&amp;gt;
     &amp;lt;tr valign=&amp;quot;top&amp;quot;&amp;gt;
       &amp;lt;td class=&amp;quot;code&amp;quot;&amp;gt;&amp;#94; &amp;#40;caret&amp;#41; &amp;lt;/td&amp;gt;
       &amp;lt;td&amp;gt;Marks the beginning of the string &amp;lt;/td&amp;gt;
     &amp;lt;/tr&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;pre&gt;&lt;code&gt;     &amp;lt;tr valign=&amp;quot;top&amp;quot;&amp;gt;
       &amp;lt;td class=&amp;quot;code&amp;quot;&amp;gt;$ &amp;#40;dollar sign&amp;#41; &amp;lt;/td&amp;gt;
       &amp;lt;td&amp;gt;Marks the end of the string &amp;lt;/td&amp;gt;
     &amp;lt;/tr&amp;gt;
     &amp;lt;tr valign=&amp;quot;top&amp;quot;&amp;gt;
       &amp;lt;td class=&amp;quot;code&amp;quot;&amp;gt;&amp;#95; &amp;#40;underscore&amp;#41;&amp;lt;/td&amp;gt;
       &amp;lt;td&amp;gt;Matches the beginning of the string, the end of the string, white space, or a delimiter &amp;#40;comma, brace, parenthesis&amp;#41;&amp;lt;/td&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;pre&gt;&lt;code&gt;     &amp;lt;/tr&amp;gt;
     &amp;lt;tr valign=&amp;quot;top&amp;quot;&amp;gt;
       &amp;lt;td class=&amp;quot;code&amp;quot;&amp;gt;&amp;#91;&amp;#93; &amp;#40;brackets&amp;#41; &amp;lt;/td&amp;gt;
       &amp;lt;td&amp;gt;Designate a range of single character patterns &amp;lt;/td&amp;gt;
     &amp;lt;/tr&amp;gt;
     &amp;lt;tr valign=&amp;quot;top&amp;quot;&amp;gt;
       &amp;lt;td class=&amp;quot;code&amp;quot;&amp;gt;- &amp;#40;hyphen&amp;#41; &amp;lt;/td&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;pre&gt;&lt;code&gt;       &amp;lt;td&amp;gt;Specify a range of characters &amp;lt;/td&amp;gt;
     &amp;lt;/tr&amp;gt;
     &amp;lt;tr valign=&amp;quot;top&amp;quot;&amp;gt;
       &amp;lt;td class=&amp;quot;code&amp;quot;&amp;gt;&amp;#40;&amp;#41; &amp;#40;parentheses&amp;#41; &amp;lt;/td&amp;gt;
       &amp;lt;td&amp;gt;BGP specific symbols - parentheses designate a pattern as a confederation name &amp;lt;/td&amp;gt;
     &amp;lt;/tr&amp;gt;
     &amp;lt;tr valign=&amp;quot;top&amp;quot;&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;pre&gt;&lt;code&gt;       &amp;lt;td class=&amp;quot;code&amp;quot;&amp;gt;\ &amp;#40;backslash&amp;#41; &amp;lt;/td&amp;gt;
       &amp;lt;td&amp;gt;Escape character &amp;#40;use before character to modify&amp;#41;&amp;lt;/td&amp;gt;
     &amp;lt;/tr&amp;gt;
     &amp;lt;tr valign=&amp;quot;top&amp;quot;&amp;gt;
       &amp;lt;td class=&amp;quot;code&amp;quot;&amp;gt;.&amp;#42;&amp;lt;/td&amp;gt;
       &amp;lt;td&amp;gt;Match anything &amp;lt;/td&amp;gt;
     &amp;lt;/tr&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;pre&gt;&lt;code&gt;     &amp;lt;tr valign=&amp;quot;top&amp;quot;&amp;gt;
       &amp;lt;td class=&amp;quot;code&amp;quot;&amp;gt;&amp;amp;nbsp;&amp;lt;/td&amp;gt;
       &amp;lt;td&amp;gt;&amp;amp;nbsp;&amp;lt;/td&amp;gt;
     &amp;lt;/tr&amp;gt;
     &amp;lt;tr valign=&amp;quot;top&amp;quot;&amp;gt;
       &amp;lt;td class=&amp;quot;code&amp;quot;&amp;gt;&amp;#94;$&amp;lt;/td&amp;gt;
       &amp;lt;td&amp;gt;Match any paths originating in own AS &amp;lt;/td&amp;gt;
     &amp;lt;/tr&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;pre&gt;&lt;code&gt;     &amp;lt;tr valign=&amp;quot;top&amp;quot;&amp;gt;
       &amp;lt;td class=&amp;quot;code&amp;quot;&amp;gt;&amp;#94;100$&amp;lt;/td&amp;gt;
       &amp;lt;td&amp;gt;Match paths from directly connected AS 100 &amp;lt;/td&amp;gt;
     &amp;lt;/tr&amp;gt;
     &amp;lt;tr valign=&amp;quot;top&amp;quot;&amp;gt;
       &amp;lt;td class=&amp;quot;code&amp;quot;&amp;gt;&amp;#95;200&amp;#95;&amp;lt;/td&amp;gt;
       &amp;lt;td&amp;gt;Match any path that has transited AS 200 &amp;lt;/td&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;pre&gt;&lt;code&gt;     &amp;lt;/tr&amp;gt;
     &amp;lt;tr valign=&amp;quot;top&amp;quot;&amp;gt;
       &amp;lt;td class=&amp;quot;code&amp;quot;&amp;gt;&amp;#95;300$&amp;lt;/td&amp;gt;
       &amp;lt;td&amp;gt;Match all paths originating in AS 300 &amp;lt;/td&amp;gt;
     &amp;lt;/tr&amp;gt;
     &amp;lt;tr valign=&amp;quot;top&amp;quot;&amp;gt;
       &amp;lt;td class=&amp;quot;code&amp;quot;&amp;gt;&amp;#94;400&amp;#95;&amp;lt;/td&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;pre&gt;&lt;code&gt;       &amp;lt;td&amp;gt;Match paths transiting directly connected AS 400 &amp;lt;/td&amp;gt;
     &amp;lt;/tr&amp;gt;
     &amp;lt;tr valign=&amp;quot;top&amp;quot;&amp;gt;
       &amp;lt;td width=&amp;quot;50%&amp;quot; class=&amp;quot;code&amp;quot;&amp;gt;&amp;#95;&amp;#91;1234&amp;#93;00&amp;#95;&amp;lt;/td&amp;gt;
       &amp;lt;td width=&amp;quot;50%&amp;quot;&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Match any path that has transited through AS 100, 200, 300 or 400  &lt;/td&gt;&lt;pre&gt;&lt;code&gt;     &amp;lt;/tr&amp;gt;
   &amp;lt;/table&amp;gt; 
&lt;/code&gt;&lt;/pre&gt;&lt;h2&gt;&lt;a name=&quot;links&quot;&gt;&lt;/a&gt;Links&lt;/h2&gt;&lt;/p&gt;&lt;p&gt;&lt;a href='http://www.cisco.com/warp/public/459/bgp-toc.html'&gt;BGP 4 Case Studies&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;a href='http://www.cisco.com/en/US/tech/tk365/technologies&amp;#95;tech&amp;#95;note09186a0080094826.shtml'&gt;Understanding Route Aggregation in BGP&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;a href='http://www.cisco.com/en/US/tech/tk365/technologies&amp;#95;tech&amp;#95;note09186a0080094431.shtml'&gt;BGP Best Path Selection Algorithm&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;a href='http://www.cisco.com/en/US/tech/tk365/technologies&amp;#95;q&amp;#95;and&amp;#95;a&amp;#95;item09186a00800949e8.shtml'&gt;BGP FAQ &lt;/a&gt;&lt;/p&gt;&lt;pre&gt;&lt;code&gt; &amp;lt;!-- InstanceEndEditable --&amp;gt;&amp;lt;/div&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;pre&gt;&lt;code&gt;       &amp;lt;div id=&amp;quot;footer&amp;quot;&amp;gt;&amp;lt;!-- InstanceBeginEditable name=&amp;quot;Footer&amp;quot; --&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;h3&gt;&lt;a name=&quot;appendix&quot;&gt;&lt;/a&gt;Appendix&lt;/h3&gt;&lt;ul&gt;&lt;li&gt;The most common reasons for a prefix not showing up in the routing table are:&lt;ul&gt;&lt;li&gt;Ther router trying to advertise the prefix doesn't have it in its routing table - the prefix doesn't make it to the BGP table on the origin router.&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li&gt;The prefix is not synchronized:&lt;ul&gt;&lt;li&gt;&lt;span class=&quot;content&quot;&gt;There must be a match for the prefix in the IP routing table in order for an internal (iBGP) path to be considered a valid path.&lt;/span&gt;&lt;em&gt;   &lt;span class=&quot;content&quot;&gt;If the matching route is learned from an OSPF neighbor, its OSPF router ID must match the BGP router ID of the iBGP neighbor (watch for this one on route reflectors).&lt;/span&gt;&lt;/em&gt;   There is no existing route to the BGP next hop.&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li&gt;A multihop session will not be established if the only route to the peer is a default route. A default route is never going to be used to establish a BGP session  		(iBGP/eBGP), and you will see the same (no route) output in the debugs,  		although you will be able to ping the BGP neighbor.&lt;/li&gt;&lt;li&gt;eBGP assumes directly connected peers. If doing eBGP through a FW, NAT device, etc., make sur you use the ebgp-multihop option.&lt;/li&gt;&lt;li&gt;If peering through a PIX (with identity NAT) and doing authentication, u&lt;span class=&quot;content&quot;&gt;se the norandomseq keyword to stop the PIX from offsetting the TCP sequence number by using a static (inside,outside) 172.16.11.1 172.16.11.1 netmask 255.255.255.0 norandomseq.&lt;/span&gt; Authentication will not work through NAT (breaks the MD5 hash).&lt;/li&gt;&lt;li&gt;Other gotchas with NAT are: (1) make sure the NAT device has routes to the networks you want to route to and (2) make sure the next hop is consistent with the NAT addresses.*   With iBGP watch out for logical split horizon since an iBGP router does not re-send the routes it received from other iBGP peers to other iBGP peers. It requires a full mesh or a route-reflector.&lt;/li&gt;&lt;li&gt;In &amp;quot;show ip bgp&amp;quot; the &amp;quot;*&amp;gt;&amp;quot; means that the bgp route in the bgp table was installed in the routing table.&lt;/li&gt;&lt;li&gt;To make believe you are a different AS to a peer, you can use &amp;quot;neighbor ... local-as&amp;quot; or confederations.&lt;/li&gt;&lt;li&gt;Use &amp;quot;set origin&amp;quot; in a route-map to manipulate how the origin looks like in the BGP table.&lt;/li&gt;&lt;li&gt;In &amp;quot;show ip bgp&amp;quot;, &amp;quot;*&amp;quot; means the prefix is valid, &amp;quot;&amp;gt;&amp;quot; means the prefix is installed in the routing table.&lt;/li&gt;&lt;li&gt;If you have to do filtering and the question specifies &amp;quot;use a method that is flexible to change in the future&amp;quot;, use prefix-list - they do have sequence numbers (although names access-lists now support sequencing).&lt;em&gt;   The ip prefix-list entry 0.0.0.0/0 le 32 permits everything.&lt;/em&gt;   To use &amp;quot;aggregate-address&amp;quot; to source a summary in your local BGP table, you must have at least one of its subnets in the routing table. Use the summary-only or suppress-map options to suppress more specific updates.&lt;em&gt;   If &amp;quot;aggregate-address summary-only&amp;quot; is used the sub-routes will show as suppressed in the originating router. If the question specifies that it should not be the case, use &amp;quot;aggregate-address&amp;quot; plus a filtering technique on the outbound.&lt;/em&gt;   Route filtering can be accomplished using route-map, distribute-list (access-list), filter-list (as-path), and prefix-list (range).&lt;/li&gt;&lt;li&gt;You can use an unsuppress-map on the neighbor statement to control the behavior of an aggregate-address. However, unsupress-map and route-map cannot be used toward the same neighbor, if both are configured, the route-map will be ignored.*   Do not apply both a &lt;span style=&quot;font-style: normal;&quot;&gt;neighbor distribute-list &lt;/span&gt;and a &lt;span style=&quot;font-style: normal;&quot;&gt;neighbor prefix-list&lt;/span&gt; command to a neighbor in any given direction (inbound or outbound). These two commands are mutually exclusive, and only one command (&lt;span style=&quot;font-style: normal;&quot;&gt;neighbor prefix-list&lt;/span&gt; or &lt;span style=&quot;font-style: normal;&quot;&gt;neighbor distribute-list&lt;/span&gt;) can be applied to each inbound or outbound direction.&lt;/li&gt;&lt;li&gt;By default, iBGP redistribution into IGPs (RIP, OSPF &amp;amp; ISIS) is disabled because it can lead to major real-life problems. To enable redistribution of iBGP routes into IGP use the bgp &amp;quot;redistribute-internal&amp;quot; command under the BGP routing process of the router where you want to perform the redistribution.&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&lt;h1&gt;&lt;a name=&quot;neighbor&amp;#95;formation&quot;&gt;&lt;/a&gt;Neighbor formation&lt;/h1&gt;&lt;p&gt;BGP uses TCP 179.&lt;span style='mso-spacerun:yes'&gt;  	&lt;/span&gt;This means that when R1 initiates connection, it sends it to port 179 on 	R2.&lt;span style='mso-spacerun:yes'&gt;  &lt;/span&gt;R2 will respond to the random source 	port though.&lt;span style='mso-spacerun:yes'&gt;  &lt;/span&gt;So the initiating router 	will have it as a random source port and answering router will have port 179.&lt;/p&gt;&lt;p&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/p&gt;&lt;p&gt;If both initiate at the same time, the higher BGP router-id 	is the client.&lt;span style='mso-spacerun:yes'&gt;  &lt;/span&gt;Otherwise whoever 	initiate first is client.&lt;/p&gt;&lt;p&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/p&gt;&lt;p&gt;Key thing is that the other side send packet from the IP 	have you have configured in the &lt;strong&gt;neighbor&lt;/strong&gt; 	statement.&lt;span style='mso-spacerun:yes'&gt;  &lt;/span&gt;So if there are two 	connections between 2 routers.&lt;span style='mso-spacerun:yes'&gt;  &lt;/span&gt;R1 can 	send packets from IP1 and receive packets from IP2, while R2 can receive on IP1 	and IP2, as long as the bgp neighbors are configured properly and have &lt;strong&gt;update-source&lt;i&gt;.&lt;/i&gt;&lt;/strong&gt;&lt;span style='mso-spacerun:yes'&gt;  &lt;/span&gt;Only one end is server 	so technically only need it on one side, since it decides whether to accept or 	refuse connection.&lt;/p&gt;&lt;p&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/p&gt;&lt;p&gt;&lt;!--[if gte vml 1]&gt;&lt;v:shapetype id=&quot;&lt;i&gt;x0000&lt;/i&gt;t75&quot; coordsize=&quot;21600,21600&quot; 	 o:spt=&quot;75&quot; o:preferrelative=&quot;t&quot; path=&quot;m@4@5l@4@11@9@11@9@5xe&quot; filled=&quot;f&quot; 	 stroked=&quot;f&quot;&gt; 	 &lt;v:stroke joinstyle=&quot;miter&quot;/&gt; 	 &lt;v:formulas&gt; 	  &lt;v:f eqn=&quot;if lineDrawn pixelLineWidth 0&quot;/&gt; 	  &lt;v:f eqn=&quot;sum @0 1 0&quot;/&gt; 	  &lt;v:f eqn=&quot;sum 0 0 @1&quot;/&gt; 	  &lt;v:f eqn=&quot;prod @2 1 2&quot;/&gt; 	  &lt;v:f eqn=&quot;prod @3 21600 pixelWidth&quot;/&gt; 	  &lt;v:f eqn=&quot;prod @3 21600 pixelHeight&quot;/&gt; 	  &lt;v:f eqn=&quot;sum @0 0 1&quot;/&gt; 	  &lt;v:f eqn=&quot;prod @6 1 2&quot;/&gt; 	  &lt;v:f eqn=&quot;prod @7 21600 pixelWidth&quot;/&gt; 	  &lt;v:f eqn=&quot;sum @8 21600 0&quot;/&gt; 	  &lt;v:f eqn=&quot;prod @7 21600 pixelHeight&quot;/&gt; 	  &lt;v:f eqn=&quot;sum @10 21600 0&quot;/&gt; 	 &lt;/v:formulas&gt; 	 &lt;v:path o:extrusionok=&quot;f&quot; gradientshapeok=&quot;t&quot; o:connecttype=&quot;rect&quot;/&gt; 	 &lt;o:lock v:ext=&quot;edit&quot; aspectratio=&quot;t&quot;/&gt; 	&lt;/v:shapetype&gt;&lt;v:shape id=&quot;&lt;i&gt;x0000&lt;/i&gt;i1025&quot; type=&quot;#&lt;i&gt;x0000&lt;/i&gt;t75&quot; style='width:412.5pt; 	 height:296.25pt'&gt; 	 &lt;v:imagedata src=&quot;BGP_files/image001.png&quot; o:title=&quot;&quot;/&gt; 	&lt;/v:shape&gt;&lt;![endif]--&gt;&lt;![if !vml]&gt;![](BGP_files/image002.jpg)&lt;![endif]&gt;&lt;/p&gt;&lt;p&gt;Received address or interface doesn’t matter (as long as 	exists on router). Source address is key.&lt;span style='mso-spacerun:yes'&gt;  	&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/p&gt;&lt;h1&gt;&lt;a name=&quot;ebgp&quot;&gt;&lt;/a&gt;eBGP&lt;/h1&gt;&lt;p&gt;eBGP sends out with TTL of 1.&lt;span 	style='mso-spacerun:yes'&gt;  &lt;/span&gt;So if more than one hop, use &lt;strong&gt;ebgp-multihop&lt;o:p&gt;&lt;/o:p&gt;&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;eBGP does loop prevention by AS filtering.&lt;span 	style='mso-spacerun:yes'&gt;  &lt;/span&gt;It will not accept path that has its own AS 	in it.&lt;span style='mso-spacerun:yes'&gt;  &lt;/span&gt;This is done at accepting end, 	not advertising end.&lt;span style='mso-spacerun:yes'&gt;  &lt;/span&gt;Other side will 	still advertise the prefix.&lt;/p&gt;&lt;p&gt;eBGP updates next-hop of route advertised.&lt;span 	style='mso-spacerun:yes'&gt;  &lt;/span&gt;It updates it to be the interface where it is 	peering.&lt;span style='mso-spacerun:yes'&gt;  &lt;/span&gt;So if physical, then 	physical.&lt;span style='mso-spacerun:yes'&gt;  &lt;/span&gt;If logical, logical.&lt;/p&gt;&lt;p&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/p&gt;&lt;h1&gt;&lt;a name=&quot;ibgp&quot;&gt;&lt;/a&gt;iBGP&lt;/h1&gt;&lt;p&gt;Loop prevention based on route suppression.&lt;span 	style='mso-spacerun:yes'&gt;  &lt;/span&gt;Do not advertise iBGP learned route to 	another iBGP neighbor.&lt;span style='mso-spacerun:yes'&gt;  &lt;/span&gt;So direct peering 	needed (or route reflection or confederation)&lt;/p&gt;&lt;p&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/p&gt;&lt;p&gt;There is no next hop modification.&lt;span 	style='mso-spacerun:yes'&gt;  &lt;/span&gt;To do this, you can do one of two things&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;strong&gt;neighbor &lt;/strong&gt;&lt;i&gt;x.x.x.x&lt;/i&gt;&lt;strong&gt; next-hop-self&lt;o:p&gt;&lt;/o:p&gt;&lt;/strong&gt;&lt;/li&gt;&lt;li&gt;&lt;strong&gt;route-map&lt;/strong&gt; &amp;amp; &lt;strong&gt;set ip next-hop &lt;/strong&gt;&lt;i&gt;x.x.x.x&lt;/i&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/p&gt;&lt;p&gt;Route reflector – only thing not advertised is non-client 	route to non-clients.&lt;/p&gt;&lt;p&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/p&gt;&lt;h1&gt;&lt;a name=&quot;confederations&quot;&gt;&lt;/a&gt;Confederations&lt;/h1&gt;&lt;p&gt;Private range is last 1024 of range: 64512-65535&lt;/p&gt;&lt;p&gt;Inter-sub-AS is eBGP, but neighbors within sub-AS must be 	fully meshed or need RR.&lt;span style='mso-spacerun:yes'&gt;  &lt;/span&gt;So only 	behavior changed is between sub-AS, not within.&lt;/p&gt;&lt;p&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;Router bgp &lt;/strong&gt;&lt;i&gt;sub-as&lt;/i&gt;&lt;strong&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;Bgp confederation id &lt;/strong&gt;&lt;i&gt;real-as&lt;/i&gt;&lt;strong&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;Bgp confederation peers &lt;/strong&gt;&lt;i&gt;sub-as&lt;strong&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/strong&gt;&lt;/i&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;Neighbor &lt;/strong&gt;&lt;i&gt;x.x.x.x&lt;/i&gt;&lt;strong&gt; remote-as &lt;/strong&gt;&lt;i&gt;sub-as&lt;/i&gt;&lt;strong&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/p&gt;&lt;p&gt;If in confederation, we see sub-AS in brackets () in as-path&lt;/p&gt;&lt;p&gt;If outside, it is transparent and they don’t see the sub-AS 	in there.&lt;/p&gt;&lt;p&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/p&gt;&lt;p&gt;Sub-AS do not update next hop value, even though they do 	eBGP peering within confederation sub-AS.&lt;span style='mso-spacerun:yes'&gt;  	&lt;/span&gt;eBGP peering only in the sense that send on prefix received from 	neighbor.&lt;/p&gt;&lt;p&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/p&gt;&lt;h1&gt;&lt;a name=&quot;synchronization&quot;&gt;&lt;/a&gt;Synchronization&lt;/h1&gt;&lt;p&gt;If you have routes in the BGP table but they are not marked 	as best routes, check two things:&lt;/p&gt;&lt;p&gt;&lt;![if !supportLists]&gt;&lt;span style='mso-fareast-font-family: 	&quot;Times New Roman&quot;'&gt;&lt;span style='mso-list:Ignore'&gt;1)&lt;span style='font:7.0pt &quot;Times New Roman&quot;'&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; 	&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;![endif]&gt;Do I have reachability to the next-hop&lt;/p&gt;&lt;p&gt;&lt;![if !supportLists]&gt;&lt;span style='mso-fareast-font-family: 	&quot;Times New Roman&quot;'&gt;&lt;span style='mso-list:Ignore'&gt;2)&lt;span style='font:7.0pt &quot;Times New Roman&quot;'&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; 	&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;![endif]&gt;Synchronization&lt;/p&gt;&lt;p&gt;Issue because in BGP we only advertise our best routes.&lt;/p&gt;&lt;p&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/p&gt;&lt;p&gt;There must be a match for prefix in routing table for BGP 	path to be considered valid path.&lt;span style='mso-spacerun:yes'&gt;  &lt;/span&gt;If 	matching route learned from OSPF neighbor, OSPF router ID must match BGP router 	ID&lt;/p&gt;&lt;p&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/p&gt;&lt;p&gt;Designed to prevent traffic black holes&lt;/p&gt;&lt;p&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/p&gt;&lt;p&gt;Synchronization Solutions:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;run	     BGP everywhere – transit path knows everything&lt;/li&gt;&lt;li&gt;redistribute	     BGP into IGP&lt;/li&gt;&lt;li&gt;Tunnel	     BGP over GRE/MPLS – hiding the final destination from transit path.&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/p&gt;&lt;p&gt;By default when you redistribute BGP into IGP, only eBGP 	routes are sent.&lt;span style='mso-spacerun:yes'&gt;  &lt;/span&gt;If you want to send 	iBGP too, then you need **Bgp 	redistribute-internal**.&lt;span style='mso-spacerun:yes'&gt;  &lt;/span&gt;This is so 	that you don’t run into loops.&lt;/p&gt;&lt;p&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/p&gt;&lt;h1&gt;&lt;a name=&quot;path&amp;#95;selection&quot;&gt;&lt;/a&gt;Path selection&lt;/h1&gt;&lt;ol&gt;&lt;li&gt;weight	     – inbound, locally significant&lt;/li&gt;&lt;li&gt;local	     pref – local to AS&lt;/li&gt;&lt;li&gt;locally	     origin – network, redistribute, route injection over aggregate-address&lt;/li&gt;&lt;li&gt;AS-path	     – unless specifically told to ignore it.&lt;span style='mso-spacerun:yes'&gt;	     &lt;/span&gt;AS_SET counts as 1, no matter how many AS inside the set, and	     AS_CONFED’s are not included&lt;/li&gt;&lt;li&gt;Origin	     – IGP over EGP over incomplete&lt;/li&gt;&lt;li&gt;Med	     – if not set, assigned value 0, which is best med.&lt;span	     style='mso-spacerun:yes'&gt;  &lt;/span&gt;Can change so missing is worst with the &lt;strong&gt;bgp bestpath missing-as-worst&lt;/strong&gt;.&lt;span	     style='mso-spacerun:yes'&gt;  &lt;/span&gt;Also only compared if first AS in both	     path is the same (unless disabled via **bgp	     always-compare-med**)&lt;/li&gt;&lt;li&gt;eBGP	     over iBGP&lt;/li&gt;&lt;li&gt;shortest	     internal path&lt;/li&gt;&lt;li&gt;oldest	     received&lt;/li&gt;&lt;li&gt;lowest	     router-id&lt;/li&gt;&lt;li&gt;minimum	     cluster-list length&lt;/li&gt;&lt;li&gt;lowest	     neighbor id&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/p&gt;&lt;p&gt;Inbound routing policy affects the outbound traffic.&lt;span 	style='mso-spacerun:yes'&gt;  &lt;/span&gt;Weight and local preference are set in bound 	and affect how we send traffic out.&lt;/p&gt;&lt;p&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/p&gt;&lt;p&gt;Outbound routing policy affects the inbound traffic. &lt;span 	style='mso-spacerun:yes'&gt; &lt;/span&gt;For example AS Path or MED are set outbound 	but affects how traffic is sent to you.&lt;/p&gt;&lt;p&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/p&gt;&lt;p&gt;Cannot apply attributes in the neighbor route-map.&lt;span 	style='mso-spacerun:yes'&gt;  &lt;/span&gt;That is only for filtering prefix’s.&lt;span 	style='mso-spacerun:yes'&gt;  &lt;/span&gt;Attributes are applied inbound or outbound 	anyway&lt;/p&gt;&lt;p&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/p&gt;&lt;h1&gt;&lt;a name=&quot;med&quot;&gt;&lt;/a&gt;MED&lt;/h1&gt;&lt;p&gt;BGP compares multiple paths based on order they were 	received.&lt;span style='mso-spacerun:yes'&gt;  &lt;/span&gt;By default, MED is only 	compared if the first AS in AS-PATH is the same.&lt;span 	style='mso-spacerun:yes'&gt;  &lt;/span&gt;However, if these multiple paths were 	received apart, then they might not be lined up in BGP table adjacent and so 	in-between path might prevent their comparison.&lt;/p&gt;&lt;p&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/p&gt;&lt;p&gt;For example suppose these three path were available (listed 	in reverse order of reception like BGP would show):&lt;/p&gt;&lt;p&gt;&lt;![if !supportLists]&gt;&lt;span style='mso-fareast-font-family: 	&quot;Times New Roman&quot;'&gt;&lt;span style='mso-list:Ignore'&gt;1)&lt;span style='font:7.0pt &quot;Times New Roman&quot;'&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; 	&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;![endif]&gt;AS Path: 500, med 150, external, RID: 3.3.3.3&lt;/p&gt;&lt;p&gt;&lt;![if !supportLists]&gt;&lt;span style='mso-fareast-font-family: 	&quot;Times New Roman&quot;'&gt;&lt;span style='mso-list:Ignore'&gt;2)&lt;span style='font:7.0pt &quot;Times New Roman&quot;'&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; 	&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;![endif]&gt;AS Path: 100, med 200, external, RID: 1.1.1.1&lt;/p&gt;&lt;p&gt;&lt;![if !supportLists]&gt;&lt;span style='mso-fareast-font-family: 	&quot;Times New Roman&quot;'&gt;&lt;span style='mso-list:Ignore'&gt;3)&lt;span style='font:7.0pt &quot;Times New Roman&quot;'&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/p&gt;&lt;p&gt;	&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;![endif]&gt;AS Path: 500, med 100, internal, RID: 2.2.2.2&lt;/p&gt;&lt;p&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/p&gt;&lt;p&gt;When comparing, BGP would compare 1 &amp;amp; 2 first.&lt;span 	style='mso-spacerun:yes'&gt;  &lt;/span&gt;Since AS is different, MED is ignored and it 	ends up deciding based on RID and picking 2.&lt;/p&gt;&lt;p&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/p&gt;&lt;p&gt;If **bgp 	always-compare-med** is enabled, then it will always compare the MED, 	regardless of AS.&lt;span style='mso-spacerun:yes'&gt;  &lt;/span&gt;So in above example, 	it would compare MED and pick 1 due to lower MED.&lt;/p&gt;&lt;p&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/p&gt;&lt;p&gt;If **bgp 	deterministic-med** is enabled, then it would group the prefix based on AS 	and then start the comparison once it has picked the best path per AS.&lt;span 	style='mso-spacerun:yes'&gt;  &lt;/span&gt;So they would end up being arranged as:&lt;/p&gt;&lt;p&gt;&lt;![if !supportLists]&gt;&lt;span style='mso-fareast-font-family: 	&quot;Times New Roman&quot;'&gt;&lt;span style='mso-list:Ignore'&gt;1)&lt;span style='font:7.0pt &quot;Times New Roman&quot;'&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; 	&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;![endif]&gt;AS Path: 500, med 150, external, RID: 3.3.3.3&lt;/p&gt;&lt;p&gt;&lt;![if !supportLists]&gt;&lt;span style='mso-fareast-font-family: 	&quot;Times New Roman&quot;'&gt;&lt;span style='mso-list:Ignore'&gt;2)&lt;span style='font:7.0pt &quot;Times New Roman&quot;'&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/p&gt;&lt;p&gt;	&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;![endif]&gt;AS Path: 500, med 100, internal, RID: 2.2.2.2&lt;/p&gt;&lt;p&gt;&lt;![if !supportLists]&gt;&lt;span style='mso-fareast-font-family: 	&quot;Times New Roman&quot;'&gt;&lt;span style='mso-list:Ignore'&gt;3)&lt;span style='font:7.0pt &quot;Times New Roman&quot;'&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; 	&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;![endif]&gt;AS Path: 100, med 200, external, RID: 1.1.1.1&lt;/p&gt;&lt;p&gt;First it would compare all in AS500, picking 2 due to lower 	MED.&lt;span style='mso-spacerun:yes'&gt;  &lt;/span&gt;Similarly compare all from AS 100 	and pick 3 since it is the only one.&lt;span style='mso-spacerun:yes'&gt;  	&lt;/span&gt;Then compare 2 &amp;amp; 3 and pick 3 since it is an external route (MED is 	ignored since no &lt;strong&gt;bgp always-compare-med&lt;/strong&gt;.&lt;span 	style='mso-spacerun:yes'&gt;  &lt;/span&gt;If that was enabled also then 2 would have 	been picked).&lt;/p&gt;&lt;p&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/p&gt;&lt;h1&gt;&lt;a name=&quot;summarization&quot;&gt;&lt;/a&gt;Summarization&lt;/h1&gt;&lt;p&gt;&lt;strong&gt;Aggregate-address&lt;/strong&gt; 	– requires at least one subnet of aggregate installed in BGP table, not 	necessarily the IP routing table.&lt;/p&gt;&lt;p&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/p&gt;&lt;p&gt;Can let component subnets through in two ways.&lt;span 	style='mso-spacerun:yes'&gt;  &lt;/span&gt;Either apply &lt;strong&gt;suppress-map.&lt;/strong&gt; Or &lt;strong&gt;summary-only&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;	with an &lt;strong&gt;unsuppress-map&lt;/strong&gt;.&lt;span 	style='mso-spacerun:yes'&gt;  &lt;/span&gt;In the latter, the &lt;strong&gt;show ip bgp&lt;/strong&gt; will show the components with an &lt;i&gt;s&lt;strong&gt; &lt;/strong&gt;&lt;/i&gt;to indicate 	suppression but if you look at the **show 	ip bgp nei &lt;strong&gt;&lt;i&gt;nei&lt;/i&gt;&lt;/strong&gt; adv**, you can see them being advertised.&lt;span 	style='mso-spacerun:yes'&gt;  &lt;/span&gt;Unsuppress-map is applied in the neighbor command 	while suppress-map is applied in the aggregate-address command.&lt;/p&gt;&lt;p&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/p&gt;&lt;p&gt;By default aggregate-address also wipes out the AS path 	information.&lt;span style='mso-spacerun:yes'&gt;  &lt;/span&gt;If you want to retain the 	AS information from the component subnets, use the &lt;strong&gt;as-set&lt;/strong&gt; keyword after aggregate-address&lt;/p&gt;&lt;p&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/p&gt;&lt;p&gt;Creating an aggregate with the &lt;strong&gt;as-set&lt;/strong&gt; keyword increases risk that the other AS might drop it since 	they see their AS in the path.&lt;span style='mso-spacerun:yes'&gt;  &lt;/span&gt;So if 	have &lt;strong&gt;summary-only&lt;/strong&gt; and &lt;strong&gt;as-set&lt;/strong&gt; could be breaking reachability.&lt;span 	style='mso-spacerun:yes'&gt;  &lt;/span&gt;&lt;strong&gt;Advertise-map&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;	comes to the rescue allowing us to filter which AS we want to allow into the 	AS-SET by selecting only those routes (using route-map that matches an as-path 	list).&lt;span style='mso-spacerun:yes'&gt;  &lt;/span&gt;The aggregate is still one that 	encompasses all AS’s but the only ones showing in the AS-SET will be the ones 	matching our advertise-map criteria, so we get to “define” the AS-SET in 	effect.&lt;span style='mso-spacerun:yes'&gt;  &lt;/span&gt;Basically advertise-map means 	only advertise the aggregate if these specific routes exist, and not any 	component route of the aggregate.&lt;span style='mso-spacerun:yes'&gt;  	&lt;/span&gt;Therefore, downside is that if the routes matching advertise-map 	disappear, then the aggregate will be removed.&lt;/p&gt;&lt;p&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/p&gt;&lt;p&gt;Another way to allow external AS to receive this aggregate with 	AS information is the &lt;strong&gt;neighbor &lt;/strong&gt;&lt;i&gt;nei &lt;/i&gt;&lt;strong&gt;allow-as-in&lt;/strong&gt;.&lt;span 	style='mso-spacerun:yes'&gt;  &lt;/span&gt;This allows receiving the prefix from a 	neighbor even if our AS is in the path.&lt;/p&gt;&lt;p&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/p&gt;&lt;h1&gt;&lt;a name=&quot;conditional&amp;#95;advertisement&quot;&gt;&lt;/a&gt;Conditional advertisement&lt;/h1&gt;&lt;p&gt;Used to control the direction of inbound traffic.&lt;span 	style='mso-spacerun:yes'&gt;  &lt;/span&gt;Gives us more control than using MED/AS-PATH 	because in that case the other AS’s in between can override using weight/local 	pref and send traffic back to us via another inbound path.&lt;span 	style='mso-spacerun:yes'&gt;  &lt;/span&gt;With conditional advertisement, there is only 	one way for the traffic to go since only advertised one direction.&lt;span 	style='mso-spacerun:yes'&gt;  &lt;/span&gt;Other direction only comes out if primary 	path fails.&lt;/p&gt;&lt;p&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;Neighbor &lt;/strong&gt;&lt;i&gt;ip&lt;/i&gt;** 	advertise-map &lt;strong&gt;&lt;i&gt;route-map1 &lt;/i&gt;&lt;/strong&gt;non-exist-map&lt;strong&gt;&lt;i&gt; route-map2&lt;/i&gt;&lt;/strong&gt;&lt;o:p&gt;&lt;/o:p&gt;**&lt;/p&gt;&lt;p&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/p&gt;&lt;p&gt;Route-map2 matches the primary link and make sure it is 	available.&lt;span style='mso-spacerun:yes'&gt;  &lt;/span&gt;If it isn’t, then it 	advertises the secondary path listed in route-map1.&lt;/p&gt;&lt;p&gt;Both prefixes being matched need to exist in the BGP table, 	not routing table.&lt;/p&gt;&lt;p&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/p&gt;&lt;p&gt;&lt;!--[if gte vml 1]&gt;&lt;v:shape id=&quot;&lt;i&gt;x0000&lt;/i&gt;i1026&quot; type=&quot;#&lt;i&gt;x0000&lt;/i&gt;t75&quot; 	 style='width:413.25pt;height:216.75pt'&gt; 	 &lt;v:imagedata src=&quot;BGP_files/image003.png&quot; o:title=&quot;&quot;/&gt; 	&lt;/v:shape&gt;&lt;![endif]--&gt;&lt;![if !vml]&gt;![](BGP_files/image004.jpg)&lt;![endif]&gt;&lt;/p&gt;&lt;p&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/p&gt;&lt;p&gt;R3 is advertising the network.&lt;span 	style='mso-spacerun:yes'&gt;  &lt;/span&gt;It wants R5 to use R1 to get to it so it 	as-path prepends out to R5.&lt;span style='mso-spacerun:yes'&gt;  &lt;/span&gt;However R1 	doesn’t like that and wants to use R5 to get to R3. &lt;span 	style='mso-spacerun:yes'&gt; &lt;/span&gt;So it sets a higher weight on all routes 	coming from R5.&lt;span style='mso-spacerun:yes'&gt;  &lt;/span&gt;At this point since R5’s 	route is via R1, it will not advertise that back to R1, and so R1 only has one 	route in its table – direct via R3.&lt;span style='mso-spacerun:yes'&gt;  &lt;/span&gt;So 	have to clear neighborship with R3 till order of operation is such that the 	weight kicks in first.&lt;span style='mso-spacerun:yes'&gt;  &lt;/span&gt;Then R1 will use 	R5 to get to R3, and R5 will go direct&lt;/p&gt;&lt;p&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/p&gt;&lt;p&gt;So if R3 really wanted to control the path, and not let R1 	override it, it would conditionally advertise the network only out via R1.&lt;span 	style='mso-spacerun:yes'&gt;  &lt;/span&gt;And advertise it out R5 when the link between 	R3 and R1 goes down only.&lt;/p&gt;&lt;p&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/p&gt;&lt;h1&gt;&lt;a name=&quot;conditional&amp;#95;route&amp;#95;injection&quot;&gt;&lt;/a&gt;Conditional Route Injection&lt;/h1&gt;&lt;p&gt;Prefix origination&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Network&lt;/li&gt;&lt;li&gt;Redistribution&lt;/li&gt;&lt;li&gt;Conditional	     route injection&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/p&gt;&lt;p&gt;Originate component subnets from a received aggregate subnet 	for traffic engineering&lt;/p&gt;&lt;p&gt;&lt;strong&gt;Bgp inject-map&lt;/strong&gt;&lt;i&gt; inject&lt;/i&gt;&lt;strong&gt; exist-map&lt;/strong&gt;&lt;i&gt; exist&lt;o:p&gt;&lt;/o:p&gt;&lt;/i&gt;&lt;/p&gt;&lt;p&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/p&gt;&lt;p&gt;Inject-map: prefix-list to originate (&lt;strong&gt;set ip address prefix-list&lt;/strong&gt;)&lt;/p&gt;&lt;p&gt;Exist-map: match the aggregate prefix (&lt;strong&gt;match ip address prefix-list&lt;/strong&gt;) and source of aggregate (&lt;strong&gt;match ip route-source prefix-list&lt;/strong&gt;)&lt;/p&gt;&lt;p&gt;The source has to be defined in a prefix-list (/32 mask 	obviously)&lt;strong&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/p&gt;&lt;h1&gt;&lt;a name=&quot;outbound&amp;#95;route&amp;#95;filtering&quot;&gt;&lt;/a&gt;Outbound route filtering&lt;/h1&gt;&lt;p&gt;Traditional route filtering, upstream provider sends&lt;/p&gt;&lt;ul&gt;&lt;li&gt;full	     bgp table&lt;/li&gt;&lt;li&gt;default	     only&lt;/li&gt;&lt;li&gt;default	     plus local&lt;/li&gt;&lt;li&gt;no	     complex view&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/p&gt;&lt;p&gt;Inbound filtering on downstream neighbor is useless since 	full view must still be processed by BGP inbound RIB (there is inbound and 	outbound RIB)&lt;/p&gt;&lt;p&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/p&gt;&lt;p&gt;ORF allows downstream neighbor to control what upstream 	neighbor advertises&lt;/p&gt;&lt;p&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/p&gt;&lt;p&gt;Requires the IPv4 address-family.&lt;/p&gt;&lt;p&gt;**Address-family 	ipv4-unicast&lt;o:p&gt;&lt;/o:p&gt;**&lt;/p&gt;&lt;p&gt;&lt;strong&gt;Neighbor &lt;/strong&gt;&lt;i&gt;nei&lt;/i&gt;** 	activate&lt;o:p&gt;&lt;/o:p&gt;**&lt;/p&gt;&lt;p&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/p&gt;&lt;p&gt;Upstream neighbor should be configured to receive ORF&lt;/p&gt;&lt;p&gt;&lt;strong&gt;Neighbor &lt;/strong&gt;&lt;i&gt;downstream&lt;/i&gt;&lt;strong&gt; capability orf prefix-list receive&lt;o:p&gt;&lt;/o:p&gt;&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/p&gt;&lt;p&gt;Downstream neighbor should be configured to send ORF, and 	define the prefix-list&lt;/p&gt;&lt;p&gt;&lt;strong&gt;Neighbor &lt;/strong&gt;&lt;i&gt;upstream&lt;/i&gt;&lt;strong&gt; capability orf prefix-list send&lt;o:p&gt;&lt;/o:p&gt;&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;Neighbor &lt;/strong&gt;&lt;i&gt;upstream&lt;/i&gt;&lt;strong&gt; prefix-list &lt;/strong&gt;&lt;i&gt;prefix &lt;/i&gt;&lt;strong&gt;in&lt;o:p&gt;&lt;/o:p&gt;&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/p&gt;&lt;p&gt;To clear the bgp advertisement, you have to &lt;strong&gt;clear ip bgp * in prefix&lt;o:p&gt;&lt;/o:p&gt;&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/p&gt;&lt;h1&gt;&lt;a name=&quot;communities&quot;&gt;&lt;/a&gt;Communities&lt;/h1&gt;&lt;p&gt;Used to group prefixes&lt;/p&gt;&lt;p&gt;Not sent to any neighbor by default.&lt;span 	style='mso-spacerun:yes'&gt;  &lt;/span&gt;Need &lt;strong&gt;send-community&lt;/strong&gt; 	command.&lt;/p&gt;&lt;p&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/p&gt;&lt;p&gt;Match using an ip community-list which is called inside 	route-map&lt;/p&gt;&lt;p&gt;Set using set community in route-map&lt;/p&gt;&lt;p&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/p&gt;&lt;p&gt;Well known:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;No-advertise:	     do not advertise to any neighbor&lt;/li&gt;&lt;li&gt;No-export:	     do not advertise to eBGP.&lt;span style='mso-spacerun:yes'&gt;  &lt;/span&gt;will be	     passed between sub-AS but won’t leave main confederation)&lt;/li&gt;&lt;li&gt;Local-as:	     do not advertise out of sub-AS&lt;/li&gt;&lt;li&gt;Internet:	     like no community.&lt;span style='mso-spacerun:yes'&gt;  &lt;/span&gt;Everything by	     default has it.&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/p&gt;&lt;p&gt;New format of community only for display purposes when 	showing config.&lt;span style='mso-spacerun:yes'&gt;  &lt;/span&gt;&lt;strong&gt;Ip bgp-community new-format&lt;/strong&gt; to enable that.&lt;span 	style='mso-spacerun:yes'&gt;  &lt;/span&gt;Value is still old way.&lt;/p&gt;&lt;p&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/p&gt;&lt;h1&gt;&lt;a name=&quot;misc&quot;&gt;&lt;/a&gt;Misc&lt;/h1&gt;&lt;p&gt;Order of preference – inbound&lt;/p&gt;&lt;p&gt;&lt;![if !supportLists]&gt;&lt;span style='mso-fareast-font-family: 	&quot;Times New Roman&quot;'&gt;&lt;span style='mso-list:Ignore'&gt;1)&lt;span style='font:7.0pt &quot;Times New Roman&quot;'&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; 	&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;![endif]&gt;route-map&lt;/p&gt;&lt;p&gt;&lt;![if !supportLists]&gt;&lt;span style='mso-fareast-font-family: 	&quot;Times New Roman&quot;'&gt;&lt;span style='mso-list:Ignore'&gt;2)&lt;span style='font:7.0pt &quot;Times New Roman&quot;'&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; 	&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;![endif]&gt;filter-list&lt;/p&gt;&lt;p&gt;&lt;![if !supportLists]&gt;&lt;span style='mso-fareast-font-family: 	&quot;Times New Roman&quot;'&gt;&lt;span style='mso-list:Ignore'&gt;3)&lt;span style='font:7.0pt &quot;Times New Roman&quot;'&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; 	&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;![endif]&gt;prefix-list or distribute-list&lt;/p&gt;&lt;p&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/p&gt;&lt;p&gt;Order of preference – inbound&lt;/p&gt;&lt;p&gt;&lt;![if !supportLists]&gt;&lt;span style='mso-fareast-font-family: 	&quot;Times New Roman&quot;'&gt;&lt;span style='mso-list:Ignore'&gt;1)&lt;span style='font:7.0pt &quot;Times New Roman&quot;'&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; 	&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;![endif]&gt;prefix-list or distribute-list&lt;/p&gt;&lt;p&gt;&lt;![if !supportLists]&gt;&lt;span style='mso-fareast-font-family: 	&quot;Times New Roman&quot;'&gt;&lt;span style='mso-list:Ignore'&gt;2)&lt;span style='font:7.0pt &quot;Times New Roman&quot;'&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/p&gt;&lt;p&gt;	&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;![endif]&gt;filter-list&lt;/p&gt;&lt;p&gt;&lt;![if !supportLists]&gt;&lt;span style='mso-fareast-font-family: 	&quot;Times New Roman&quot;'&gt;&lt;span style='mso-list:Ignore'&gt;3)&lt;span style='font:7.0pt &quot;Times New Roman&quot;'&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; 	&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;![endif]&gt;route-map&lt;/p&gt;&lt;p&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/p&gt;&lt;p&gt;If &lt;strong&gt;auto-summary&lt;/strong&gt; 	is enabled and you redistribute connected routes into BGP, they come in as 	classful.&lt;/p&gt;&lt;p&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/p&gt;&lt;p&gt;If you have **no 	auto-summary&lt;strong&gt; have a &lt;/strong&gt;network** 	command to advertise prefix without a mask on it, and you don’t have the entire 	class, then it will not be advertised.&lt;/p&gt;&lt;p&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/p&gt;&lt;p&gt;Can define dampening per prefix using a route-map.&lt;span 	style='mso-spacerun:yes'&gt;  &lt;/span&gt;Default values set using &lt;strong&gt;bgp dampening&lt;/strong&gt; do not apply to the route-map defined by &lt;strong&gt;bgp dampening route-map&lt;/strong&gt; and so you have 	to manually define them using **set 	dampening** in the route-map.&lt;/p&gt;&lt;p&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/p&gt;&lt;p&gt;Local-AS used during AS migration.&lt;span 	style='mso-spacerun:yes'&gt;  &lt;/span&gt;Update **router 	bgp&lt;strong&gt; with the new AS number and use &lt;/strong&gt;neighbor 	&lt;strong&gt;&lt;i&gt;nei&lt;/i&gt;&lt;/strong&gt; local-as** with the old AS till the neighbor updates his 	configuration.&lt;/p&gt;&lt;p&gt;There is also a &lt;strong&gt;no-prepend&lt;/strong&gt; 	option to the command, because by default any prefix coming in or going out to 	the neighbor will have the local-as prepended to it.&lt;span 	style='mso-spacerun:yes'&gt;  &lt;/span&gt;When receiving, local-as is the most 	recent.&lt;span style='mso-spacerun:yes'&gt;  &lt;/span&gt;When sending, local-as is again 	the most recent, and the router bgp AS is second.&lt;/p&gt;&lt;p&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/p&gt;&lt;p&gt;`External BGP failover is detected based on line protocol of 	interface, when it goes down, peer is considered down.&lt;span 	style='mso-spacerun:yes'&gt;  &lt;/span&gt;**No bgp 	fast-external-fallover** makes it so that router waits the holdtime before 	considering peer down.&lt;span style='mso-spacerun:yes'&gt;  &lt;/span&gt;Useful if flaky connection 	that goes up &amp;amp; down a lot and you don’t want peering relationship to be 	broken each time.&lt;/p&gt;&lt;p&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/p&gt;&lt;p&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/p&gt;&lt;p&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/p&gt;
</description>
<pubDate>
Sat, 21 Mar 2009 00:00:00 +1300
</pubDate>
<author>
Andrés Gasson
</author>
</item>
<item>
<guid>
http://geek.red-elvis.net/posts/2008-04-22-ffmpeg.html
</guid>
<link>
http://geek.red-elvis.net/posts/2008-04-22-ffmpeg.html
</link>
<title>
FFMPEG Notes
</title>
<description>
&lt;h1&gt;FFmpeg Howto&lt;/h1&gt;&lt;h2&gt;Generic Syntax&lt;/h2&gt;&lt;pre&gt;&lt;code&gt; ffmpeg &amp;#91;&amp;#91;infile options&amp;#93;&amp;#91;`-i' infile&amp;#93;&amp;#93;... {&amp;#91;outfile options&amp;#93; outfile}... 
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Note : As a general rule, options are applied to the next specified file. Therefore, order is important and you can have the same option on the command line multiple times. Each occurrence is then applied to the next input or output file.&lt;/p&gt;&lt;h2&gt;Main Options&lt;/h2&gt;&lt;pre&gt;&lt;code&gt;-ab \&amp;lt;int\&amp;gt; : Set audio bitrate in bit/s &amp;#40; default = 64k &amp;#41;.

-acodec \&amp;lt;string\&amp;gt; : Force audio codec.

 :   aac : AAC-LC ac3 : AC3 &amp;#40; Dolby Digital &amp;#41; copy : Copy raw codec
   data as is. mp2 : MPEG Audio Layer II mp3 : MPEG Audio Layer III
   pcm\&amp;#95;s16le : Uncompressed 16-bit PCM Audio
 
-an : Disable audio.
 
-ar \&amp;lt;int\&amp;gt; : Set audio sampling frequency in Hz &amp;#40; default = 44100 Hz&amp;#41;.

-aspect \&amp;lt;string or float\&amp;gt; : Set aspect ratio &amp;#40; 4:3, 16:9, 1.3333,1.7777 &amp;#41;.

-async \&amp;lt;int\&amp;gt; : Audio sync method. Audio will be stretched or
squeezed to match the timestamps. The parameter is the maximum samples
per second by which the audio is changed. -async 1 is a special case
where only the start of the audio stream is corrected without any
later correction. 
 
-b \&amp;lt;int\&amp;gt; : Set video bitrate in bit/s &amp;#40; default = 200k &amp;#41;.

-bf \&amp;lt;int\&amp;gt; : Set number of B-frames &amp;#40; supported for MPEG-1, MPEG-2 and MPEG-4 &amp;#41;.

-b\&amp;#95;strategy \&amp;lt;boolean\&amp;gt; : Strategy to choose between I/P/B-frames &amp;#40; 0 = off / 1 = on &amp;#41;.

-bufsize \&amp;lt;int\&amp;gt; : Set rate control buffer size &amp;#40; in bits &amp;#41;.

-cmp \&amp;lt;string or int\&amp;gt; : Full pel motion estimation compare function.

 :   sad &amp;#40; 0 &amp;#41; : Sum of absolute differences, fast &amp;#40; default &amp;#41;. sse &amp;#40; 1 &amp;#41; : Sum of squared errors. satd &amp;#40; 2 &amp;#41; : Sum of absolute Hadamard transformed differences. dct &amp;#40; 3 &amp;#41; : Sum of absolute DCT transformed differences. psnr &amp;#40; 4 &amp;#41; : Sum of squared quantization errors &amp;#40; avoid, low quality &amp;#41;. bit &amp;#40; 5 &amp;#41; : Number of bits needed for the block. rd &amp;#40; 6 &amp;#41; : Rate distortion optimal, slow. zero &amp;#40; 7 &amp;#41; : 0. vsad &amp;#40; 8 &amp;#41; : Sum of absolute vertical differences. vsse &amp;#40; 9 &amp;#41; : Sum of squared vertical differences. nsse &amp;#40; 10 &amp;#41; : Noise preserving sum of squared differences. w53 &amp;#40; 11 &amp;#41; : 5/3 wavelet &amp;#40; only used in Snow &amp;#41;. w97 &amp;#40; 12 &amp;#41; : 9/7 wavelet &amp;#40; only used in Snow &amp;#41;. dctmax &amp;#40; 13 &amp;#41; chroma &amp;#40; 14 &amp;#41;
&lt;/code&gt;&lt;/pre&gt; &lt;br /&gt;&lt;pre&gt;&lt;code&gt;-coder \&amp;lt;string or int\&amp;gt; :

:   vlc &amp;#40; 0 &amp;#41; : Variable length coder / huffman coder. ac &amp;#40; 1 &amp;#41; :
  Arithmetic coder. raw &amp;#40; 2 &amp;#41; : Raw &amp;#40; no encoding &amp;#41;. rle &amp;#40; 3 &amp;#41; :
  Run-length coder. deflate &amp;#40; 4 &amp;#41; : Deflate-based coder.

-cropbottom \&amp;lt;int\&amp;gt; : Set bottom crop band size &amp;#40; in pixels &amp;#41;.

-cropleft \&amp;lt;int\&amp;gt; : Set left crop band size &amp;#40; in pixels &amp;#41;.

-cropright \&amp;lt;int\&amp;gt; : Set right crop band size &amp;#40; in pixels &amp;#41;.

-croptop \&amp;lt;int\&amp;gt; : Set top crop band size &amp;#40; in pixels &amp;#41;.

-deinterlace : Deinterlace pictures.

-dc \&amp;lt;int\&amp;gt; : Intra DC precision.

-f \&amp;lt;string\&amp;gt; : Force file
&lt;/code&gt;&lt;/pre&gt;
</description>
<pubDate>
Tue, 22 Apr 2008 00:00:00 +1200
</pubDate>
<author>
Andrés Gasson
</author>
</item>
<item>
<guid>
http://geek.red-elvis.net/posts/2007-01-25-Statistic-notes.html
</guid>
<link>
http://geek.red-elvis.net/posts/2007-01-25-Statistic-notes.html
</link>
<title>
Statistics Notes
</title>
<description>
&lt;pre&gt;&lt;code&gt;mean   μ = ∑x/n
median &amp;#40;n+1&amp;#41;/2 on ordered sequence
mode   most frequent

variance  = ∑&amp;#40;x-μ&amp;#41;2/n = ∑x2/n - μ2
std-dev = σ = √&amp;#40;variance&amp;#41;

standard score   z = x - μ / σ
&lt;/code&gt;&lt;/pre&gt; [way of comparing values across different data sets ie diff means y std dev's  transforms sets of data into new theretical distn with mean of and std dev of 1  standard score = # of std devs from the mean ]&lt;h2&gt;&lt;a name=&quot;probability&quot;&gt;&lt;/a&gt;Probability&lt;/h2&gt;defn: &lt;strong&gt;Event&lt;/strong&gt; is any occurence that has a probability attached to it.&lt;pre&gt;&lt;code&gt;probability P&amp;#40;A&amp;#41; = n&amp;#40;A&amp;#41;/ n&amp;#40;S&amp;#41;
 n&amp;#40;A&amp;#41;= number of ways of getting an event A
 n&amp;#40;S&amp;#41; = number of possible outcomes
S known as Probability Space or sample Space
A' is known as complemntary event of A &amp;#40;ie A does NOT occur&amp;#41;
P&amp;#40;A'&amp;#41; = 1 - P&amp;#40;A&amp;#41;
&lt;/code&gt;&lt;/pre&gt;&lt;pre&gt;&lt;code&gt;intersection ∩ &amp;#40;and&amp;#41;
union        ∪ &amp;#40;or&amp;#41;
&amp;quot;given&amp;quot;  |
&lt;/code&gt;&lt;/pre&gt;&lt;pre&gt;&lt;code&gt;P&amp;#40;A | B&amp;#41; = probability of event A 'given' event B
P&amp;#40;A | B&amp;#41; = P&amp;#40;A ∩ B&amp;#41;/ P&amp;#40;B&amp;#41;
&lt;/code&gt;&lt;/pre&gt;&lt;h3&gt;&lt;a name=&quot;law&amp;#95;of&amp;#95;total&amp;#95;probability&quot;&gt;&lt;/a&gt;Law of Total Probability&lt;/h3&gt;&lt;pre&gt;&lt;code&gt; P&amp;#40;B&amp;#41; = P&amp;#40;B ∩ A&amp;#41; + P&amp;#40;B ∩ A'&amp;#41;
    = P&amp;#40;A&amp;#41;P&amp;#40;B | A&amp;#41; + P&amp;#40;A'&amp;#41;P&amp;#40;B | A'&amp;#41;
&lt;/code&gt;&lt;/pre&gt;The Law of Total probability is the denominator of Bayes' Theorem&lt;h3&gt;&lt;a name=&quot;bayes&amp;#95;theorem&quot;&gt;&lt;/a&gt;Bayes Theorem&lt;/h3&gt;&lt;pre&gt;&lt;code&gt;P&amp;#40;A | B&amp;#41; = p&amp;#40;A&amp;#41; x P&amp;#40;B | A&amp;#41;/&amp;#40;P&amp;#40;A&amp;#41; x P&amp;#40;B | A&amp;#41; + P&amp;#40;A'&amp;#41; x P&amp;#40;B | A'&amp;#41; &amp;#41;
&lt;/code&gt;&lt;/pre&gt;&lt;pre&gt;&lt;code&gt;Independent events P&amp;#40;A | B&amp;#41; = P&amp;#40;A&amp;#41;
&lt;/code&gt;&lt;/pre&gt;&lt;h2&gt;&lt;a name=&quot;discrete&amp;#95;probability&amp;#95;distributions&quot;&gt;&lt;/a&gt;Discrete Probability Distributions&lt;/h2&gt;A random variable use capitals aka Xparticular values of random variables use lowercase aka xTherefore P(X = x) The rpobability that the random variable X takes particular value xvariable is &lt;strong&gt;discrete&lt;/strong&gt; means that it can only take exact values&lt;p&gt;The &lt;strong&gt;Expectation E(X)&lt;/strong&gt; of a variable X is a bit like the mean, but for probabilyt distributions. To find expectation you multiply each value x by the probability of getting that value and then sum the results&lt;/p&gt;&lt;pre&gt;&lt;code&gt;E&amp;#40;X&amp;#41; = ∑xP&amp;#40;X = x&amp;#41;
&lt;/code&gt;&lt;/pre&gt;
</description>
<pubDate>
Thu, 25 Jan 2007 00:00:00 +1300
</pubDate>
<author>
Andrés Gasson
</author>
</item>
</channel>
</rss>
